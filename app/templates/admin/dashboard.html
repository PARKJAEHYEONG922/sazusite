{% extends "layout/admin_base.html" %}

{% block page_title %}대시보드{% endblock %}

{% block extra_css %}
<style>
    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
    }

    .stat-number {
        font-size: 36px;
        font-weight: bold;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 8px;
    }

    .stat-label {
        color: #a0a0a0;
        font-size: 14px;
    }

    .section {
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
    }

    .section h2 {
        font-size: 20px;
        margin-bottom: 20px;
        color: #f093fb;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    th {
        color: #a0a0a0;
        font-size: 14px;
        font-weight: normal;
    }

    td {
        color: #d0d0d0;
    }

    .badge {
        display: inline-block;
        padding: 4px 12px;
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid #4CAF50;
        border-radius: 12px;
        font-size: 12px;
        color: #4CAF50;
    }
</style>
{% endblock %}

{% block admin_content %}
<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ total_today }}</div>
        <div class="stat-label">오늘 전체 조회</div>
    </div>

    <div class="stat-card">
        <div class="stat-number">{{ stats.today_count }}</div>
        <div class="stat-label">오늘의 운세</div>
    </div>

    <div class="stat-card">
        <div class="stat-number">{{ stats.saju_count }}</div>
        <div class="stat-label">정통 사주</div>
    </div>

    <div class="stat-card">
        <div class="stat-number">{{ stats.match_count }}</div>
        <div class="stat-label">사주궁합</div>
    </div>

    <div class="stat-card">
        <div class="stat-number">{{ stats.dream_count }}</div>
        <div class="stat-label">꿈해몽</div>
    </div>
</div>

<div class="section">
    <h2>최근 조회</h2>
    <table>
        <thead>
            <tr>
                <th>시간</th>
                <th>서비스</th>
                <th>생년월일</th>
                <th>성별</th>
                <th>캐시</th>
            </tr>
        </thead>
        <tbody>
            {% if recent_logs %}
                {% for log in recent_logs %}
                <tr>
                    <td>{{ log.created_at.strftime('%H:%M:%S') }}</td>
                    <td>{{ log.service_code }}</td>
                    <td>{{ log.request_payload.birthdate if log.request_payload else '-' }}</td>
                    <td>{{ '남성' if log.request_payload and log.request_payload.gender == 'male' else '여성' }}</td>
                    <td>
                        {% if log.is_from_cache %}
                        <span class="badge">캐시</span>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="5" style="text-align: center; color: #666;">조회 기록이 없습니다</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<div class="section">
    <h2>시스템 정보</h2>
    <p>사이트 이름: {{ site_config.site_name if site_config else '명월헌' }}</p>
    <p>데이터베이스: SQLite</p>
    <p>AI 모델: Gemini 2.0 Flash</p>
</div>
{% endblock %}
