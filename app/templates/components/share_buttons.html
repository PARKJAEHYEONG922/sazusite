<!-- SNS 공유 버튼 컴포넌트 -->
<div class="share-buttons">
    <div class="share-item" onclick="shareKakao()">
        <img src="{{ url_for('static', path='/icons/kakao.svg') }}" class="share-icon" alt="카카오톡">
        <span class="share-label">카카오톡 공유</span>
    </div>
    <div class="share-item" id="copyLinkBtn" onclick="copyLink()">
        <svg class="share-icon share-icon-link" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
        </svg>
        <span class="share-label">URL 복사</span>
    </div>
</div>

<style>
/* 공유 버튼 스타일 */
.share-buttons {
    display: flex;
    gap: 40px;
    justify-content: center;
    align-items: center;
    margin: 30px 0;
}

.share-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: transform 0.2s;
}

.share-item:hover {
    transform: translateY(-5px);
}

.share-icon {
    width: 70px;
    height: 70px;
    transition: all 0.3s;
}

.share-icon-link {
    background: #ffffff;
    border-radius: 50%;
    padding: 15px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.share-item:hover .share-icon-link {
    stroke: #5568d3;
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
}

.share-item.copied .share-icon-link {
    stroke: #4CAF50;
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5);
}

.share-label {
    font-size: 14px;
    font-weight: 500;
    color: #555;
    white-space: nowrap;
}

@media (max-width: 768px) {
    .share-buttons {
        flex-direction: row;
        gap: 30px;
    }

    .share-icon {
        width: 65px;
        height: 65px;
    }

    .share-label {
        font-size: 13px;
    }
}
</style>

<script>
// SNS 공유 기능 스크립트

// 공유 가능한 고유 URL 생성
function getShareUrl() {
    return window.location.href;
}

// 카카오톡 공유
function shareKakao() {
    if (typeof Kakao === 'undefined') {
        alert('카카오톡 공유 기능을 불러오는 중입니다. 잠시 후 다시 시도해주세요.');
        return;
    }

    const pageUrl = getShareUrl();
    const pageTitle = document.title;
    const pageDescription = document.querySelector('meta[name="description"]')?.content || '{{ service.character_name }}이 자세히 풀어드린 {{ service.title }} 결과를 확인하세요.';
    const ogImage = document.querySelector('meta[property="og:image"]')?.content;
    const imageUrl = ogImage || '{{ service.character_image if service.character_image else url_for("static", path="/uploads/banner_1.webp") }}';

    Kakao.Share.sendDefault({
        objectType: 'feed',
        content: {
            title: pageTitle,
            description: pageDescription,
            imageUrl: imageUrl.startsWith('http') ? imageUrl : window.location.origin + imageUrl,
            link: {
                mobileWebUrl: pageUrl,
                webUrl: pageUrl
            }
        },
        buttons: [
            {
                title: '결과 보기',
                link: {
                    mobileWebUrl: pageUrl,
                    webUrl: pageUrl
                }
            }
        ]
    });
}

// URL 복사
function copyLink() {
    const pageUrl = getShareUrl();
    const btn = document.getElementById('copyLinkBtn');
    const label = btn.querySelector('.share-label');

    if (navigator.clipboard && window.isSecureContext) {
        // 최신 브라우저 (HTTPS 환경)
        navigator.clipboard.writeText(pageUrl).then(() => {
            btn.classList.add('copied');
            label.textContent = '복사 완료!';

            setTimeout(() => {
                btn.classList.remove('copied');
                label.textContent = 'URL 복사';
            }, 2000);
        }).catch(err => {
            alert('링크 복사 실패: ' + err);
        });
    } else {
        // 구형 브라우저 또는 HTTP 환경 (폴백)
        const textarea = document.createElement('textarea');
        textarea.value = pageUrl;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();

        try {
            const successful = document.execCommand('copy');
            if (successful) {
                btn.classList.add('copied');
                label.textContent = '복사 완료!';

                setTimeout(() => {
                    btn.classList.remove('copied');
                    label.textContent = 'URL 복사';
                }, 2000);
            } else {
                alert('링크 복사에 실패했습니다. 수동으로 복사해주세요:\n' + pageUrl);
            }
        } catch (err) {
            alert('링크 복사에 실패했습니다. 수동으로 복사해주세요:\n' + pageUrl);
        } finally {
            document.body.removeChild(textarea);
        }
    }
}
</script>
