<!-- SNS 공유 버튼 컴포넌트 -->
<div class="share-buttons">
    <button class="share-btn share-btn-kakao" onclick="shareKakao()">
        <img src="{{ url_for('static', path='/icons/kakao.svg') }}" width="20" alt="카카오톡">
        카카오톡 공유
    </button>
    <button class="share-btn share-btn-link" id="copyLinkBtn" onclick="copyLink()">
        <img src="{{ url_for('static', path='/icons/link.svg') }}" width="20" alt="링크 복사">
        링크 복사
    </button>
</div>

<style>
/* 공유 버튼 스타일 */
.share-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 30px 0;
    flex-wrap: wrap;
}

.share-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.share-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.share-btn-kakao {
    background: #FEE500;
    color: #000000;
}

.share-btn-kakao:hover {
    background: #F5DC00;
}

.share-btn-link {
    background: #667eea;
    color: white;
}

.share-btn-link:hover {
    background: #5568d3;
}

.share-btn-link.copied {
    background: #4CAF50;
}

@media (max-width: 768px) {
    .share-buttons {
        flex-direction: column;
        align-items: stretch;
        padding: 0 20px;
    }

    .share-btn {
        justify-content: center;
    }
}
</style>

<script>
// SNS 공유 기능 스크립트

// 공유 가능한 고유 URL 생성
function getShareUrl() {
    return window.location.href;
}

// 카카오톡 공유
function shareKakao() {
    if (typeof Kakao === 'undefined') {
        alert('카카오톡 공유 기능을 불러오는 중입니다. 잠시 후 다시 시도해주세요.');
        return;
    }

    const pageUrl = getShareUrl();
    const pageTitle = document.title;
    const pageDescription = document.querySelector('meta[name="description"]')?.content || '{{ service.character_name }}이 자세히 풀어드린 {{ service.title }} 결과를 확인하세요.';
    const ogImage = document.querySelector('meta[property="og:image"]')?.content;
    const imageUrl = ogImage || '{{ service.character_image if service.character_image else url_for("static", path="/uploads/banner_1.webp") }}';

    Kakao.Share.sendDefault({
        objectType: 'feed',
        content: {
            title: pageTitle,
            description: pageDescription,
            imageUrl: imageUrl.startsWith('http') ? imageUrl : window.location.origin + imageUrl,
            link: {
                mobileWebUrl: pageUrl,
                webUrl: pageUrl
            }
        },
        buttons: [
            {
                title: '결과 보기',
                link: {
                    mobileWebUrl: pageUrl,
                    webUrl: pageUrl
                }
            }
        ]
    });
}

// URL 복사
function copyLink() {
    const pageUrl = getShareUrl();
    const btn = document.getElementById('copyLinkBtn');

    if (navigator.clipboard && window.isSecureContext) {
        // 최신 브라우저 (HTTPS 환경)
        navigator.clipboard.writeText(pageUrl).then(() => {
            btn.classList.add('copied');
            btn.innerHTML = '<img src="{{ url_for("static", path="/icons/link.svg") }}" width="20" alt="링크 복사"> 복사 완료!';

            setTimeout(() => {
                btn.classList.remove('copied');
                btn.innerHTML = '<img src="{{ url_for("static", path="/icons/link.svg") }}" width="20" alt="링크 복사"> 링크 복사';
            }, 2000);
        }).catch(err => {
            alert('링크 복사 실패: ' + err);
        });
    } else {
        // 구형 브라우저 또는 HTTP 환경 (폴백)
        const textarea = document.createElement('textarea');
        textarea.value = pageUrl;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();

        try {
            const successful = document.execCommand('copy');
            if (successful) {
                btn.classList.add('copied');
                btn.innerHTML = '<img src="{{ url_for("static", path="/icons/link.svg") }}" width="20" alt="링크 복사"> 복사 완료!';

                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.innerHTML = '<img src="{{ url_for("static", path="/icons/link.svg") }}" width="20" alt="링크 복사"> 링크 복사';
                }, 2000);
            } else {
                alert('링크 복사에 실패했습니다. 수동으로 복사해주세요:\n' + pageUrl);
            }
        } catch (err) {
            alert('링크 복사에 실패했습니다. 수동으로 복사해주세요:\n' + pageUrl);
        } finally {
            document.body.removeChild(textarea);
        }
    }
}
</script>
