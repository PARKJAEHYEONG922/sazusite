{% extends "layout/base.html" %}

{% block title %}{{ service.title }} - {{ site_config.site_name if site_config else "ëª…ì›”í—Œ" }}{% endblock %}

{% block meta_description %}{{ service.description if service.description else service.title + ' - ' + service.subtitle }}. ì •í™•í•œ {{ service.title }} í’€ì´ë¥¼ ë¬´ë£Œë¡œ ë°›ì•„ë³´ì„¸ìš”.{% endblock %}

{% block meta_keywords %}{{ service.title }}, {% if service.code == 'today' %}ì˜¤ëŠ˜ì˜ ìš´ì„¸, ë ë³„ìš´ì„¸, ë³„ìë¦¬ìš´ì„¸{% elif service.code == 'newyear2026' %}2026ë…„ ìš´ì„¸, ì‹ ë…„ìš´ì„¸, í•œ í•´ ìš´ì„¸{% elif service.code == 'saju' %}ì‚¬ì£¼, ì‚¬ì£¼íŒ”ì, ì •í†µì‚¬ì£¼, ëª…ë¦¬í•™{% elif service.code == 'match' %}ê¶í•©, ì‚¬ì£¼ê¶í•©, ì—°ì• ìš´{% elif service.code == 'dream' %}ê¿ˆí•´ëª½, ê¿ˆí’€ì´{% endif %}, ë¬´ë£Œìš´ì„¸{% endblock %}

{% block og_title %}{{ service.title }} - {{ service.character_name }}ì´ ì•Œë ¤ë“œë ¤ìš”{% endblock %}

{% block og_description %}{{ service.description if service.description else service.subtitle }}{% endblock %}

{% block og_image %}{{ service.character_form_image if service.character_form_image else service.character_image if service.character_image else url_for('static', path='/images/og-default.jpg') }}{% endblock %}

{% block extra_css %}
<!-- ê³µí†µ ìŠ¤íƒ€ì¼ì€ fortune-forms.cssë¡œ ì´ë™ -->
<!-- ì‚¬ì£¼ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ë§Œ ì—¬ê¸°ì— -->
{% endblock %}

{% block content %}
<div class="fortune-header">
    <div class="character-emoji">
        {% if service.character_form_image %}
            {% if service.character_form_image.endswith(('.mp4', '.webm')) or '.mp4?' in service.character_form_image or '.webm?' in service.character_form_image %}
            <video autoplay loop muted playsinline class="character-form-image">
                <source src="{{ service.character_form_image }}" type="video/{{ 'mp4' if '.mp4' in service.character_form_image else 'webm' }}">
            </video>
            {% else %}
            <img src="{{ service.character_form_image }}" alt="{{ service.character_name }}" class="character-form-image">
            {% endif %}
        {% else %}
            {{ service.character_emoji }}
        {% endif %}
    </div>
    <h1 class="fortune-title">{{ service.title }}</h1>
    <p class="fortune-subtitle">{{ service.subtitle }}</p>
    <p class="fortune-description">{{ service.description }}</p>
</div>

<div class="form-container">
    <form method="POST" action="/fortune/{{ service.code }}" id="fortuneForm">
        {% if service.code != "dream" %}
        <div class="form-group">
            {% if service.code == "today" %}
            <label for="name">ì´ë¦„ *</label>
            <input type="text" id="name" name="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            {% else %}
            <label for="name">ì´ë¦„ (ì„ íƒ)</label>
            <input type="text" id="name" name="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            {% endif %}
        </div>

        <div class="form-group">
            <div class="label-with-calendar">
                <label for="birthdate">ìƒë…„ì›”ì¼ *</label>
                <div class="calendar-buttons">
                    <button type="button" class="calendar-btn active" data-calendar="solar">
                        <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M8 16C10.1217 16 12.1566 15.1571 13.6569 13.6569C15.1571 12.1566 16 10.1217 16 8C16 5.87827 15.1571 3.84344 13.6569 2.34315C12.1566 0.842855 10.1217 0 8 0C5.87827 0 3.84344 0.842855 2.34315 2.34315C0.842855 3.84344 0 5.87827 0 8C0 10.1217 0.842855 12.1566 2.34315 13.6569C3.84344 15.1571 5.87827 16 8 16ZM11.707 6.707C11.8892 6.5184 11.99 6.2658 11.9877 6.0036C11.9854 5.7414 11.8802 5.49059 11.6948 5.30518C11.5094 5.11977 11.2586 5.0146 10.9964 5.01233C10.7342 5.01005 10.4816 5.11084 10.293 5.293L7 8.586L5.707 7.293C5.5184 7.11084 5.2658 7.01005 5.0036 7.01233C4.7414 7.0146 4.49059 7.11977 4.30518 7.30518C4.11977 7.49059 4.0146 7.7414 4.01233 8.0036C4.01005 8.2658 4.11084 8.5184 4.293 8.707L6.293 10.707C6.48053 10.8945 6.73484 10.9998 7 10.9998C7.26516 10.9998 7.51947 10.8945 7.707 10.707L11.707 6.707Z" fill="#999"></path>
                        </svg>
                        <span>ì–‘ë ¥</span>
                    </button>
                    <button type="button" class="calendar-btn" data-calendar="lunar">
                        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="9" cy="9" r="8" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></circle>
                            <path d="M6.33333 9L8.11111 10.7778L11.6667 7.22222" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <span>ìŒë ¥</span>
                    </button>
                </div>
            </div>
            <input type="text" id="birthdate" name="birthdate" placeholder="1965.09.22" inputmode="numeric" required>
            <input type="hidden" id="birthdate_hidden" name="birthdate_actual">
            <input type="hidden" id="calendar" name="calendar" value="solar">
        </div>

        <div class="form-group">
            <label>ì„±ë³„ *</label>
            <div class="gender-buttons">
                <button type="button" class="gender-btn" data-gender="male">
                    <span>ë‚¨ì„±</span>
                </button>
                <button type="button" class="gender-btn" data-gender="female">
                    <span>ì—¬ì„±</span>
                </button>
            </div>
            <input type="hidden" id="gender" name="gender" required>
        </div>
        {% endif %}

        {% if service.code == "today" %}
        <div class="form-group">
            <label for="birth_time">íƒœì–´ë‚œ ì‹œê°„ (ì„ íƒ)</label>
            <select id="birth_time" name="birth_time">
                <option value="">ëª¨ë¦„</option>
                <option value="23">ìì‹œ å­ (23:00-00:59)</option>
                <option value="01">ì¶•ì‹œ ä¸‘ (01:00-02:59)</option>
                <option value="03">ì¸ì‹œ å¯… (03:00-04:59)</option>
                <option value="05">ë¬˜ì‹œ å¯ (05:00-06:59)</option>
                <option value="07">ì§„ì‹œ è¾° (07:00-08:59)</option>
                <option value="09">ì‚¬ì‹œ å·³ (09:00-10:59)</option>
                <option value="11">ì˜¤ì‹œ åˆ (11:00-12:59)</option>
                <option value="13">ë¯¸ì‹œ æœª (13:00-14:59)</option>
                <option value="15">ì‹ ì‹œ ç”³ (15:00-16:59)</option>
                <option value="17">ìœ ì‹œ é…‰ (17:00-18:59)</option>
                <option value="19">ìˆ ì‹œ æˆŒ (19:00-20:59)</option>
                <option value="21">í•´ì‹œ äº¥ (21:00-22:59)</option>
            </select>
        </div>
        {% endif %}

        {% if service.code == "saju" %}
        <div class="form-group">
            <label for="birth_time">íƒœì–´ë‚œ ì‹œê°„ (ì„ íƒ)</label>
            <select id="birth_time" name="birth_time">
                <option value="">ëª¨ë¦„</option>
                <option value="23">ìì‹œ å­ (23:00-00:59)</option>
                <option value="01">ì¶•ì‹œ ä¸‘ (01:00-02:59)</option>
                <option value="03">ì¸ì‹œ å¯… (03:00-04:59)</option>
                <option value="05">ë¬˜ì‹œ å¯ (05:00-06:59)</option>
                <option value="07">ì§„ì‹œ è¾° (07:00-08:59)</option>
                <option value="09">ì‚¬ì‹œ å·³ (09:00-10:59)</option>
                <option value="11">ì˜¤ì‹œ åˆ (11:00-12:59)</option>
                <option value="13">ë¯¸ì‹œ æœª (13:00-14:59)</option>
                <option value="15">ì‹ ì‹œ ç”³ (15:00-16:59)</option>
                <option value="17">ìœ ì‹œ é…‰ (17:00-18:59)</option>
                <option value="19">ìˆ ì‹œ æˆŒ (19:00-20:59)</option>
                <option value="21">í•´ì‹œ äº¥ (21:00-22:59)</option>
            </select>
        </div>
        {% endif %}

        {% if service.code == "newyear2026" %}
        <div class="form-group">
            <label for="birth_time">íƒœì–´ë‚œ ì‹œê°„ (ì„ íƒ)</label>
            <select id="birth_time" name="birth_time">
                <option value="">ëª¨ë¦„</option>
                <option value="23">ìì‹œ å­ (23:00-00:59)</option>
                <option value="01">ì¶•ì‹œ ä¸‘ (01:00-02:59)</option>
                <option value="03">ì¸ì‹œ å¯… (03:00-04:59)</option>
                <option value="05">ë¬˜ì‹œ å¯ (05:00-06:59)</option>
                <option value="07">ì§„ì‹œ è¾° (07:00-08:59)</option>
                <option value="09">ì‚¬ì‹œ å·³ (09:00-10:59)</option>
                <option value="11">ì˜¤ì‹œ åˆ (11:00-12:59)</option>
                <option value="13">ë¯¸ì‹œ æœª (13:00-14:59)</option>
                <option value="15">ì‹ ì‹œ ç”³ (15:00-16:59)</option>
                <option value="17">ìœ ì‹œ é…‰ (17:00-18:59)</option>
                <option value="19">ìˆ ì‹œ æˆŒ (19:00-20:59)</option>
                <option value="21">í•´ì‹œ äº¥ (21:00-22:59)</option>
            </select>
        </div>
        {% endif %}

        {% if service.code == "match" %}
        <div class="section-divider">
            <h3 class="form-section-title">ìƒëŒ€ë°© ì •ë³´</h3>
        </div>

        <div class="form-group">
            <label for="partner_name">ìƒëŒ€ë°© ì´ë¦„ (ì„ íƒ)</label>
            <input type="text" id="partner_name" name="partner_name" placeholder="ìƒëŒ€ë°© ì´ë¦„">
        </div>

        <div class="form-group">
            <div class="label-with-calendar">
                <label for="partner_birthdate">ìƒëŒ€ë°© ìƒë…„ì›”ì¼ *</label>
                <div class="calendar-buttons">
                    <button type="button" class="calendar-btn active" data-calendar="solar" data-target="partner_calendar">
                        <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M8 16C10.1217 16 12.1566 15.1571 13.6569 13.6569C15.1571 12.1566 16 10.1217 16 8C16 5.87827 15.1571 3.84344 13.6569 2.34315C12.1566 0.842855 10.1217 0 8 0C5.87827 0 3.84344 0.842855 2.34315 2.34315C0.842855 3.84344 0 5.87827 0 8C0 10.1217 0.842855 12.1566 2.34315 13.6569C3.84344 15.1571 5.87827 16 8 16ZM11.707 6.707C11.8892 6.5184 11.99 6.2658 11.9877 6.0036C11.9854 5.7414 11.8802 5.49059 11.6948 5.30518C11.5094 5.11977 11.2586 5.0146 10.9964 5.01233C10.7342 5.01005 10.4816 5.11084 10.293 5.293L7 8.586L5.707 7.293C5.5184 7.11084 5.2658 7.01005 5.0036 7.01233C4.7414 7.0146 4.49059 7.11977 4.30518 7.30518C4.11977 7.49059 4.0146 7.7414 4.01233 8.0036C4.01005 8.2658 4.11084 8.5184 4.293 8.707L6.293 10.707C6.48053 10.8945 6.73484 10.9998 7 10.9998C7.26516 10.9998 7.51947 10.8945 7.707 10.707L11.707 6.707Z" fill="#999"></path>
                        </svg>
                        <span>ì–‘ë ¥</span>
                    </button>
                    <button type="button" class="calendar-btn" data-calendar="lunar" data-target="partner_calendar">
                        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="9" cy="9" r="8" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></circle>
                            <path d="M6.33333 9L8.11111 10.7778L11.6667 7.22222" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <span>ìŒë ¥</span>
                    </button>
                </div>
            </div>
            <input type="text" id="partner_birthdate" name="partner_birthdate" placeholder="1965.09.22" inputmode="numeric" required>
            <input type="hidden" id="partner_birthdate_hidden" name="partner_birthdate_actual">
            <input type="hidden" id="partner_calendar" name="partner_calendar" value="solar">
        </div>

        <div class="form-group">
            <label>ìƒëŒ€ë°© ì„±ë³„ *</label>
            <div class="gender-buttons">
                <button type="button" class="gender-btn" data-gender="male" data-target="partner_gender">
                    <span>ë‚¨ì„±</span>
                </button>
                <button type="button" class="gender-btn" data-gender="female" data-target="partner_gender">
                    <span>ì—¬ì„±</span>
                </button>
            </div>
            <input type="hidden" id="partner_gender" name="partner_gender" required>
        </div>
        {% endif %}

        {% if service.code == "dream" %}
        <div class="form-group">
            <label for="dream_content">ê¿ˆ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš” *</label>
            <textarea id="dream_content" name="dream_content" placeholder="ì–´ì ¯ë°¤ì— ê¾¼ ê¿ˆì„ ìì„¸íˆ ì ì–´ì£¼ì‹œê²Œë‚˜..." style="min-height: 180px;" required></textarea>

            <div class="dream-tips">
                <div class="dream-tips-header">
                    <span class="dream-tips-icon">ğŸ’¡</span>
                    <span class="dream-tips-title">ë°±ìš´ì„ ìƒì˜ ê¿ˆ ì´ì•¼ê¸° ì‘ì„±ë²•</span>
                </div>
                <ul class="dream-tips-list">
                    <li><strong>ëˆ„ê°€ ë‚˜ì™”ëŠ”ê°€?</strong> ê¿ˆ ì† ì¸ë¬¼ì„ ëª…í™•íˆ ì ì–´ì£¼ì‹œê²Œ. ì•„ëŠ” ì‚¬ëŒì¸ì§€, ë‚¯ì„  ì´ì¸ì§€ ë§ì´ë„¤.</li>
                    <li><strong>ì–´ë””ì„œ ë²Œì–´ì¡ŒëŠ”ê°€?</strong> ì¥ì†Œê°€ ì¤‘ìš”í•˜ë„¤. ì§‘ì¸ì§€, ì‚°ì¸ì§€, ë¬¼ê°€ì¸ì§€ ìì„¸íˆ ë§í•´ì£¼ê²Œ.</li>
                    <li><strong>ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚¬ëŠ”ê°€?</strong> ê¿ˆ ì†ì—ì„œ ë²Œì–´ì§„ ì¼ì„ ì²˜ìŒë¶€í„° ëê¹Œì§€ ìˆœì„œëŒ€ë¡œ ë§ì”€í•´ì£¼ì‹œê²Œ.</li>
                    <li><strong>íŠ¹ë³„í•œ ë¬¼ê±´ì´ ìˆì—ˆëŠ”ê°€?</strong> ëˆ, ë™ë¬¼, ê¸ˆì€ë³´í™”... ì´ëŸ° ê²ƒë“¤ì´ ê¿ˆ í’€ì´ì˜ ì—´ì‡ ë¼ë„¤.</li>
                    <li><strong>ê¸°ë¶„ì´ ì–´ë• ëŠ”ê°€?</strong> ê¿ˆ ì†ì—ì„œ ëŠë‚€ ê°ì •ê³¼ ê¹¨ì–´ë‚˜ì„œì˜ ê¸°ë¶„ê¹Œì§€ ë§í•´ì£¼ê²Œë‚˜.</li>
                </ul>
                <div class="dream-tips-footer">
                    â­ ìì„¸íˆ ì ì„ìˆ˜ë¡ ë” ì •í™•í•œ í•´ëª½ì„ í•´ë“œë¦´ ìˆ˜ ìˆë‹µë‹ˆë‹¤
                </div>
            </div>
        </div>
        {% endif %}

        <button type="submit" class="btn-submit" id="submitBtn">
            {{ service.character_name }}ì—ê²Œ ë¬¼ì–´ë³´ê¸°
        </button>
    </form>
</div>

<script type="module">
    import { FortuneForm } from '/static/js/fortune-forms.js';
    new FortuneForm('fortuneForm', { serviceCode: '{{ service.code }}' });
</script>
{% endblock %}
