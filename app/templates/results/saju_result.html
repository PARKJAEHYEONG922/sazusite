{% extends "layout/base.html" %}

{% block title %}{{ service.title }} ê²°ê³¼ - {{ site_config.site_name if site_config else "ëª…ì›”í—Œ" }}{% endblock %}

{% block meta_description %}{{ data.name if data else 'ê³ ê°' }}ë‹˜ì˜ {{ service.title }} í’€ì´ ê²°ê³¼ì…ë‹ˆë‹¤. {{ service.character_name }}ì´ ìì„¸íˆ í’€ì–´ë“œë ¸ìŠµë‹ˆë‹¤.{% endblock %}

{% block meta_keywords %}{{ service.title }}, ì‚¬ì£¼íŒ”ì, ì •í†µì‚¬ì£¼, ëª…ë¦¬í•™, ì‚¬ì£¼ ê²°ê³¼, ìš´ì„¸ ê²°ê³¼{% endblock %}

{% block meta_robots %}noindex, nofollow{% endblock %}

{% block og_title %}{{ data.name if data else 'ê³ ê°' }}ë‹˜ì˜ {{ service.title }} ê²°ê³¼{% endblock %}

{% block og_description %}{{ service.character_name }}ì´ ìì„¸íˆ í’€ì–´ë“œë¦° {{ service.title }} ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.{% endblock %}

{% block og_image %}{{ service.character_image if service.character_image else url_for('static', path='/images/og-saju.jpg') }}{% endblock %}

{% block extra_css %}
<style>
    .result-header {
        text-align: center;
        padding: 100px 20px 40px;
        margin-top: 60px;
    }

    .character-emoji {
        font-size: 60px;
        margin-bottom: 15px;
    }

    .character-image {
        width: 100%;
        max-width: 500px;
        height: auto;
        aspect-ratio: 3 / 4;
        object-fit: cover;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        margin: 0 auto 20px;
        display: block;
    }

    @media (max-width: 768px) {
        .character-image {
            max-width: 90vw;
        }
    }

    .result-title {
        font-size: 32px;
        margin-bottom: 10px;
    }

    .result-date {
        color: #5a4a3a;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
        margin-top: 5px;
    }

    .cache-notice {
        display: inline-block;
        padding: 8px 16px;
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid #4CAF50;
        border-radius: 20px;
        color: #4CAF50;
        font-size: 14px;
        margin-top: 10px;
    }

    .result-container {
        max-width: 1100px;
        margin: 40px auto;
        padding: 0 20px;
    }

    /* ì‚¬ì£¼íŒ”ì í‘œ */
    .saju-table-container {
        background: #f9f7f4;
        border: 3px double #8b7355;
        border-radius: 8px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .saju-table-title {
        color: #5a4a3a;
        font-size: 24px;
        font-weight: 700;
        text-align: center;
        margin-bottom: 10px;
        font-family: 'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', sans-serif;
    }

    .saju-table-subtitle {
        color: #8b7355;
        text-align: center;
        margin-bottom: 25px;
        font-size: 16px;
    }

    .saju-decoration {
        display: none;
    }

    .saju-table {
        background: white;
        border: 2px solid #d4c4b0;
        border-radius: 6px;
        overflow: hidden;
    }

    .saju-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .saju-table th {
        background: #8b7355;
        color: #fff9f0;
        padding: 15px;
        font-weight: 600;
        text-align: center;
        font-size: 15px;
        border: 1px solid #6d5940;
    }

    .saju-table td {
        padding: 18px;
        text-align: center;
        border: 1px solid #e8dcc8;
        font-size: 16px;
        color: #333;
    }

    .saju-table .pillar-header {
        background: #6d5940;
        color: #fff9f0;
        font-weight: 700;
        font-size: 18px;
        border: 1px solid #5a4a3a;
    }

    .saju-char {
        font-size: 28px;
        font-weight: 700;
        padding: 8px 12px;
        border-radius: 8px;
        display: inline-block;
    }

    /* ì˜¤í–‰ ìƒ‰ìƒ */
    .ohang-wood { background: #4ade80; color: white; }  /* ëª© - ì´ˆë¡ */
    .ohang-fire { background: #f87171; color: white; }  /* í™” - ë¹¨ê°• */
    .ohang-earth { background: #fbbf24; color: white; } /* í†  - ë…¸ë‘ */
    .ohang-metal { background: #94a3b8; color: white; } /* ê¸ˆ - íšŒìƒ‰ */
    .ohang-water { background: #3b82f6; color: white; } /* ìˆ˜ - íŒŒë‘ */

    /* ëŒ€ìš´í‘œ */
    .daeun-container {
        background: #f9f7f4;
        border: 3px double #8b7355;
        border-radius: 8px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .daeun-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 10px;
        color: #5a4a3a;
        text-align: center;
    }

    .daeun-subtitle {
        color: #8b7355;
        margin-bottom: 25px;
        text-align: center;
        font-size: 15px;
    }

    .daeun-table {
        background: white;
        border: 2px solid #d4c4b0;
        border-radius: 6px;
        overflow-x: auto;
        margin-top: 20px;
    }

    .daeun-table table {
        width: 100%;
        border-collapse: collapse;
    }

    .daeun-table th {
        background: #8b7355;
        color: #fff9f0;
        padding: 12px;
        font-weight: 600;
        text-align: center;
        font-size: 14px;
        border: 1px solid #6d5940;
    }

    .daeun-table td {
        padding: 15px;
        text-align: center;
        border: 1px solid #e8dcc8;
        font-size: 15px;
        color: #333;
    }

    .daeun-ganzhi {
        font-size: 22px;
        font-weight: 700;
        color: #5a4a3a;
        margin-bottom: 5px;
    }

    .daeun-year {
        font-size: 13px;
        color: #8b7355;
        margin-bottom: 3px;
    }

    .daeun-age {
        font-size: 12px;
        color: #999;
        font-weight: 600;
    }

    /* ì˜¤í–‰ ë¶„ì„ */
    .ohang-container {
        background: #f9f7f4;
        border: 3px double #8b7355;
        border-radius: 8px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .ohang-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 10px;
        color: #5a4a3a;
        text-align: center;
    }

    .ohang-subtitle {
        color: #8b7355;
        margin-bottom: 25px;
        text-align: center;
    }

    /* ì˜¤í–‰ ìˆœí™˜ ë‹¤ì´ì–´ê·¸ë¨ */
    .ohang-cycle-diagram {
        position: relative;
        width: 500px;
        height: 500px;
        margin: 40px auto;
    }

    .ohang-element {
        position: absolute;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        font-weight: 700;
        color: white;
        border: 3px solid rgba(0, 0, 0, 0.2);
        z-index: 10;
    }

    .ohang-element .count {
        font-size: 15px;
        margin-top: 3px;
        font-weight: 600;
    }

    .ohang-element.wood {
        background: rgba(74, 222, 128, 0.85);
        top: 6%;
        left: 50%;
        transform: translateX(-50%);
    }

    .ohang-element.fire {
        background: rgba(248, 113, 113, 0.85);
        top: 24%;
        right: 14%;
    }

    .ohang-element.earth {
        background: rgba(251, 191, 36, 0.85);
        bottom: 18%;
        right: 18%;
    }

    .ohang-element.metal {
        background: rgba(148, 163, 184, 0.85);
        bottom: 18%;
        left: 18%;
    }

    .ohang-element.water {
        background: rgba(59, 130, 246, 0.85);
        top: 24%;
        left: 14%;
    }

    /* ìƒ/ê·¹ ë²”ë¡€ */
    .cycle-legend {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-top: 20px;
        padding: 15px;
        background: white;
        border: 2px solid #d4c4b0;
        border-radius: 6px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 16px;
        font-weight: 600;
        color: #5a4a3a;
    }

    .legend-arrow {
        width: 40px;
        height: 3px;
        position: relative;
    }

    .legend-arrow.sheng {
        background: #2563eb;
    }

    .legend-arrow.sheng::after {
        content: '';
        position: absolute;
        right: -5px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 8px solid #2563eb;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
    }

    .legend-arrow.ke {
        background: repeating-linear-gradient(
            to right,
            #dc2626 0px,
            #dc2626 8px,
            transparent 8px,
            transparent 12px
        );
        height: 2.5px;
    }

    .legend-arrow.ke::after {
        content: '';
        position: absolute;
        right: -5px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 8px solid #dc2626;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
    }

    /* SVG í™”ì‚´í‘œ ìŠ¤íƒ€ì¼ */
    .cycle-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
    }

    /* ìƒ í™”ì‚´í‘œ (íŒŒë€ìƒ‰) */
    .sheng-arrow {
        stroke: #2563eb;
        stroke-width: 4;
        fill: none;
        marker-end: url(#arrowhead-sheng);
    }

    /* ê·¹ í™”ì‚´í‘œ (ë¹¨ê°„ìƒ‰ ì ì„ ) */
    .ke-arrow {
        stroke: #dc2626;
        stroke-width: 3;
        stroke-dasharray: 10, 6;
        fill: none;
        marker-end: url(#arrowhead-ke);
    }

    /* ì˜¤í–‰ ë¹„ìœ¨ ê·¸ë˜í”„ */
    .ohang-ratio-section {
        margin-top: 30px;
        background: white;
        border: 2px solid #d4c4b0;
        border-radius: 6px;
        padding: 25px;
    }

    .ohang-ratio-title {
        font-size: 20px;
        font-weight: 700;
        color: #5a4a3a;
        margin-bottom: 20px;
        text-align: center;
    }

    .ohang-ratio-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        gap: 15px;
    }

    .ohang-ratio-label {
        min-width: 60px;
        font-size: 16px;
        font-weight: 600;
        color: #5a4a3a;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .ohang-ratio-label-hanja {
        font-size: 20px;
    }

    .ohang-ratio-bar-wrapper {
        flex: 1;
        height: 30px;
        background: #f0f0f0;
        border-radius: 15px;
        overflow: hidden;
        position: relative;
    }

    .ohang-ratio-bar {
        height: 100%;
        border-radius: 15px;
        transition: width 0.8s ease;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 10px;
        color: white;
        font-weight: 700;
        font-size: 14px;
    }

    .ohang-ratio-bar.wood {
        background: linear-gradient(90deg, rgba(74, 222, 128, 0.6), rgba(74, 222, 128, 0.9));
    }

    .ohang-ratio-bar.fire {
        background: linear-gradient(90deg, rgba(248, 113, 113, 0.6), rgba(248, 113, 113, 0.9));
    }

    .ohang-ratio-bar.earth {
        background: linear-gradient(90deg, rgba(251, 191, 36, 0.6), rgba(251, 191, 36, 0.9));
    }

    .ohang-ratio-bar.metal {
        background: linear-gradient(90deg, rgba(148, 163, 184, 0.6), rgba(148, 163, 184, 0.9));
    }

    .ohang-ratio-bar.water {
        background: linear-gradient(90deg, rgba(59, 130, 246, 0.6), rgba(59, 130, 246, 0.9));
    }

    /* ìš©ì‹  */
    .yongsin-container {
        margin-top: 30px;
        background: white;
        border: 2px solid #d4c4b0;
        border-radius: 6px;
        padding: 25px;
    }

    .yongsin-title-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
    }

    .yongsin-main-title {
        font-size: 18px;
        font-weight: 700;
        color: #5a4a3a;
    }

    .yongsin-grid {
        display: flex;
        justify-content: space-around;
        align-items: center;
        gap: 0;
    }

    .yongsin-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
        position: relative;
    }

    .yongsin-item:not(:last-child)::after {
        content: '|';
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        color: #d4c4b0;
        font-size: 24px;
        font-weight: 300;
    }

    .yongsin-label-wrapper {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 12px;
    }

    .yongsin-label {
        font-size: 14px;
        color: #8b7355;
        font-weight: 600;
    }

    .yongsin-circle {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #f9f7f4;
        border: 2px solid #d4c4b0;
        margin-bottom: 8px;
    }

    .yongsin-hanja {
        font-size: 28px;
        font-weight: 700;
        color: #5a4a3a;
        line-height: 1;
    }

    .yongsin-hangul {
        font-size: 13px;
        color: #8b7355;
        margin-top: 4px;
    }

    /* ë„ì›€ë§ ì•„ì´ì½˜ */
    .help-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #8b7355;
        color: white;
        font-size: 12px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
    }

    .help-icon:hover {
        background: #6d5940;
        transform: scale(1.1);
    }

    /* íˆ´íŒ */
    .tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #5a4a3a;
        color: white;
        padding: 10px 12px;
        border-radius: 8px;
        font-size: 11px;
        line-height: 1.5;
        white-space: normal;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
        z-index: 1000;
        margin-bottom: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        max-width: 200px;
        min-width: 180px;
        text-align: left;
        font-weight: normal;
    }

    .tooltip::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: #5a4a3a;
    }

    .help-icon:hover .tooltip {
        opacity: 1;
        visibility: visible;
    }

    /* ì‹ ê°•ì‹ ì•½ ê²Œì´ì§€ */
    .strength-container {
        margin-top: 30px;
        background: white;
        border: 2px solid #d4c4b0;
        border-radius: 6px;
        padding: 25px;
    }

    .strength-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 15px;
        color: #5a4a3a;
        text-align: center;
    }

    .strength-bar {
        position: relative;
        height: 40px;
        background: linear-gradient(to right,
            #dc2626 0%,
            #fb923c 25%,
            #fbbf24 50%,
            #4ade80 75%,
            #3b82f6 100%);
        border-radius: 6px;
        margin-bottom: 10px;
        border: 2px solid #d4c4b0;
    }

    .strength-marker {
        position: absolute;
        top: -10px;
        width: 4px;
        height: 60px;
        background: #5a4a3a;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        border-radius: 3px;
        transition: left 0.5s;
    }

    .strength-labels {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #8b7355;
        margin-top: 10px;
        font-weight: 600;
    }

    .strength-result {
        text-align: center;
        margin-top: 15px;
        font-size: 18px;
        font-weight: 700;
        color: #5a4a3a;
    }

    /* ìš´ì„¸ ì¹´ë“œ */
    .fortune-card {
        background: #ffffff;
        border: 2px solid rgba(0, 0, 0, 0.05);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 20px;
        transition: all 0.3s;
        color: #000000;
    }

    .fortune-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-color: rgba(102, 126, 234, 0.3);
    }

    .fortune-card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(0, 0, 0, 0.05);
    }

    .fortune-card-icon {
        font-size: 28px;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
    }

    .fortune-card-title {
        font-size: 20px;
        font-weight: 700;
        color: #333;
        margin: 0;
    }

    .fortune-card-content {
        font-size: 16px;
        line-height: 1.8;
        color: #444;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ì€ main.cssì—ì„œ ê³µìš©ìœ¼ë¡œ ê´€ë¦¬ */

    @media (max-width: 768px) {
        .result-container {
            padding: 0 15px;
        }

        .saju-table-container,
        .daeun-container,
        .ohang-container {
            padding: 20px;
        }

        .ohang-cycle-diagram {
            width: 300px;
            height: 300px;
            margin: 30px auto;
        }

        .ohang-element {
            width: 55px;
            height: 55px;
            font-size: 18px;
        }

        .ohang-element .count {
            font-size: 12px;
            margin-top: 2px;
        }

        .cycle-legend {
            flex-direction: column;
            gap: 15px;
        }

        .legend-item {
            font-size: 14px;
        }

        .ohang-ratio-section {
            padding: 20px;
        }

        .ohang-ratio-title {
            font-size: 18px;
        }

        .ohang-ratio-label {
            min-width: 50px;
            font-size: 14px;
        }

        .ohang-ratio-label-hanja {
            font-size: 18px;
        }

        .yongsin-container {
            padding: 20px;
        }

        .yongsin-main-title {
            font-size: 18px;
        }

        .yongsin-circle {
            width: 60px;
            height: 60px;
        }

        .yongsin-hanja {
            font-size: 24px;
        }

        .yongsin-item:not(:last-child)::after {
            font-size: 20px;
        }

        .saju-char {
            font-size: 20px;
        }

        .daeun-table {
            overflow-x: auto;
        }

        .daeun-table table {
            font-size: 12px;
        }

        .daeun-table th {
            padding: 8px 4px;
            font-size: 11px;
        }

        .daeun-table td {
            padding: 10px 4px;
            font-size: 11px;
        }

        .daeun-ganzhi {
            font-size: 16px;
        }

        .daeun-year {
            font-size: 10px;
        }

        .daeun-age {
            font-size: 9px;
        }

        .tooltip {
            max-width: 160px;
            min-width: 140px;
            font-size: 10px;
            padding: 8px 10px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="result-header">
    <div class="character-emoji">
        {% if service.character_image %}
            {% if service.character_image.endswith(('.mp4', '.webm')) or '.mp4?' in service.character_image or '.webm?' in service.character_image %}
                <video autoplay loop muted playsinline class="character-image" preload="auto">
                    <source src="{{ service.character_image }}" type="video/{{ 'mp4' if '.mp4' in service.character_image else 'webm' }}">
                    ë¸Œë¼ìš°ì €ê°€ ë¹„ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </video>
            {% else %}
                <img src="{{ service.character_image }}" alt="{{ service.character_name }}" class="character-image">
            {% endif %}
        {% else %}
            {{ service.character_emoji }}
        {% endif %}
    </div>
    <h1 class="result-title">{{ service.title }}</h1>
    <p class="result-date">{{ today.strftime('%Yë…„ %mì›” %dì¼') }}</p>
    {% if is_cached %}
    <div class="cache-notice">ì´ë¯¸ í™•ì¸í•˜ì‹  ì‚¬ì£¼ì˜ˆìš”</div>
    {% endif %}
</div>

<div class="result-container">
    <!-- ì‚¬ì£¼íŒ”ì í‘œ -->
    <div class="saju-table-container">
        <div class="saju-decoration">
            <span>â˜ï¸</span>
            <span>ğŸŒ™</span>
            <span>â­</span>
        </div>
        <h2 class="saju-table-title" id="sajuTableTitle"></h2>
        <p class="saju-table-subtitle" id="sajuTableSubtitle"></p>

        <div class="saju-table">
            <table>
                <thead>
                    <tr>
                        <th>êµ¬ë¶„</th>
                        <th class="pillar-header">æ™‚ (ì‹œ)</th>
                        <th class="pillar-header">æ—¥ (ì¼)</th>
                        <th class="pillar-header">æœˆ (ì›”)</th>
                        <th class="pillar-header">å¹´ (ë…„)</th>
                    </tr>
                </thead>
                <tbody id="sajuTableBody">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ëŒ€ìš´í‘œ -->
    <div class="daeun-container">
        <h2 class="daeun-title" id="daeunTitle"></h2>
        <p class="daeun-subtitle" id="daeunSubtitle"></p>
        <div class="daeun-table" id="daeunTable">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
    </div>

    <!-- ì˜¤í–‰ & ìš©ì‹  -->
    <div class="ohang-container">
        <h2 class="ohang-title">
            ì˜¤í–‰ë¶„í¬: ê²‰ìœ¼ë¡œ ë³´ì´ëŠ” ì˜¤í–‰ì˜ ê· í˜•
            <span class="help-icon">
                ?
                <span class="tooltip">ì˜¤í–‰ë¶„í¬ë€? ì‚¬ì£¼íŒ”ìì— ì˜¤í–‰ì´ ê°ê° ëª‡ê°œì”© ì¡´ì¬í•˜ëŠ”ì§€ì™€ ì˜¤í–‰ê°„ì˜ ìƒìƒ/ìƒê·¹ì„ ë‚˜íƒ€ë‚¸ í‘œì…ë‹ˆë‹¤</span>
            </span>
        </h2>

        <!-- ì˜¤í–‰ ìˆœí™˜ ë‹¤ì´ì–´ê·¸ë¨ -->
        <div class="ohang-cycle-diagram" id="ohangCycleDiagram">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>

        <!-- ìƒ/ê·¹ ë²”ë¡€ -->
        <div class="cycle-legend">
            <div class="legend-item">
                <div class="legend-arrow sheng"></div>
                <span>ìƒ(ç”Ÿ): ì„œë¡œ ë•ëŠ” ê´€ê³„</span>
            </div>
            <div class="legend-item">
                <div class="legend-arrow ke"></div>
                <span>ê·¹(å…‹): ì„œë¡œ ê²¬ì œí•˜ëŠ” ê´€ê³„</span>
            </div>
        </div>

        <!-- ì˜¤í–‰ ë¹„ìœ¨ ê·¸ë˜í”„ -->
        <div class="ohang-ratio-section">
            <h3 class="ohang-ratio-title">ì˜¤í–‰ ë¹„ìœ¨</h3>
            <div id="ohangRatioGraph">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>

        <!-- ìš©ì‹  -->
        <div class="yongsin-container" id="yongsinContainer">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>

        <!-- ì‹ ê°•ì‹ ì•½ -->
        <div class="strength-container">
            <h3 class="strength-title">ì‹ ê°•ì‹ ì•½</h3>
            <div class="strength-bar">
                <div class="strength-marker" id="strengthMarker"></div>
            </div>
            <div class="strength-labels">
                <span>ê·¹ì•½</span>
                <span>íƒœì•½</span>
                <span>ì‹ ì•½</span>
                <span>ì¤‘í™”</span>
                <span>ì‹ ê°•</span>
                <span>íƒœê°•</span>
                <span>ê·¹ì™•</span>
            </div>
            <div class="strength-result" id="strengthResult"></div>
        </div>
    </div>

    <!-- ìš´ì„¸ í•´ì„ -->
    <div id="fortuneContent">
        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </div>

{% include "components/share_buttons.html" %}
</div>

<div class="actions">
    <a href="/" class="btn btn-primary">ë©”ì¸ìœ¼ë¡œ</a>
    <a href="/fortune/{{ service.code }}" class="btn btn-secondary">ë‹¤ì‹œ ë³´ê¸°</a>
</div>

<script>
    // ë°±ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì‚¬ì£¼ ë°ì´í„°
    const backendSajuData = {% if result.saju_data %}{{ result.saju_data | tojson }}{% else %}null{% endif %};

    // ì‚¬ì£¼ ë°ì´í„° êµ¬ì„±
    const sajuData = {
        name: backendSajuData && backendSajuData.name ? backendSajuData.name : ("{{ request_data.name if request_data.name else 'ê³ ê°' }}" || "ê³ ê°"),
        birthdate: "{{ request_data.birthdate }}",
        birthTime: "{{ request_data.birth_time if request_data.birth_time else 'ë¯¸ìƒ' }}",
        gender: "{{ request_data.gender }}",
        pillars: backendSajuData ? backendSajuData.pillars : {},
        daeun: backendSajuData ? backendSajuData.daeun : { start_age: 0, periods: [] },
        ohang: backendSajuData ? backendSajuData.ohang : {},
        yongsin: backendSajuData ? backendSajuData.yongsin : {},
        strength: backendSajuData ? backendSajuData.strength : { level: 'ì¤‘í™”', position: 50 }
    };

    // ìš´ì„¸ í…ìŠ¤íŠ¸
    const fortuneText = {{ result.result_text | tojson }};

    // ì²œê°„/ì§€ì§€ ì˜¤í–‰ ë§¤í•‘
    const OHANG_MAP = {
        'ç”²': 'wood', 'ä¹™': 'wood',
        'ä¸™': 'fire', 'ä¸': 'fire',
        'æˆŠ': 'earth', 'å·±': 'earth',
        'åºš': 'metal', 'è¾›': 'metal',
        'å£¬': 'water', 'ç™¸': 'water',
        'å­': 'water', 'ä¸‘': 'earth', 'å¯…': 'wood', 'å¯': 'wood',
        'è¾°': 'earth', 'å·³': 'fire', 'åˆ': 'fire', 'æœª': 'earth',
        'ç”³': 'metal', 'é…‰': 'metal', 'æˆŒ': 'earth', 'äº¥': 'water'
    };

    // ì‹œê°„ í•œê¸€ ë§¤í•‘
    const TIME_MAP = {
        '23': 'å­', '01': 'ä¸‘', '03': 'å¯…', '05': 'å¯',
        '07': 'è¾°', '09': 'å·³', '11': 'åˆ', '13': 'æœª',
        '15': 'ç”³', '17': 'é…‰', '19': 'æˆŒ', '21': 'äº¥'
    };

    // ì§€ì§€ í•œê¸€ ë°œìŒ
    const JIJI_PRONUNCIATION = {
        'å­': 'ì', 'ä¸‘': 'ì¶•', 'å¯…': 'ì¸', 'å¯': 'ë¬˜',
        'è¾°': 'ì§„', 'å·³': 'ì‚¬', 'åˆ': 'ì˜¤', 'æœª': 'ë¯¸',
        'ç”³': 'ì‹ ', 'é…‰': 'ìœ ', 'æˆŒ': 'ìˆ ', 'äº¥': 'í•´'
    };

    // ì‹­ì´ìš´ì„± í•œê¸€ ì´ë¦„
    const SIPIUNSUNG_KOREAN = {
        'é•·ç”Ÿ': 'ì¥ìƒ', 'æ²æµ´': 'ëª©ìš•', 'å† å¸¶': 'ê´€ëŒ€', 'å»ºç¥¿': 'ê±´ë¡',
        'å¸æ—º': 'ì œì™•', 'è¡°': 'ì‡ ', 'ç—…': 'ë³‘', 'æ­»': 'ì‚¬',
        'å¢“': 'ë¬˜', 'çµ¶': 'ì ˆ', 'èƒ': 'íƒœ', 'é¤Š': 'ì–‘'
    };

    // ì˜¤í–‰ í•œì ë§¤í•‘ (í•œì í‚¤ + í•œê¸€ í‚¤ ëª¨ë‘ ì§€ì›)
    const OHANG_HANJA_MAP = {
        // í•œì í‚¤
        'æœ¨': { hanja: 'æœ¨', hangul: 'ëª©', type: 'wood' },
        'ç«': { hanja: 'ç«', hangul: 'í™”', type: 'fire' },
        'åœŸ': { hanja: 'åœŸ', hangul: 'í† ', type: 'earth' },
        'é‡‘': { hanja: 'é‡‘', hangul: 'ê¸ˆ', type: 'metal' },
        'æ°´': { hanja: 'æ°´', hangul: 'ìˆ˜', type: 'water' },
        // í•œê¸€ í‚¤ (ë°±ì—”ë“œì—ì„œ í•œê¸€ë¡œ ë°˜í™˜í•˜ëŠ” ê²½ìš° ëŒ€ì‘)
        'ëª©': { hanja: 'æœ¨', hangul: 'ëª©', type: 'wood' },
        'í™”': { hanja: 'ç«', hangul: 'í™”', type: 'fire' },
        'í† ': { hanja: 'åœŸ', hangul: 'í† ', type: 'earth' },
        'ê¸ˆ': { hanja: 'é‡‘', hangul: 'ê¸ˆ', type: 'metal' },
        'ìˆ˜': { hanja: 'æ°´', hangul: 'ìˆ˜', type: 'water' }
    };

    // ìƒë…„ì›”ì¼ í•œê¸€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    function formatBirthdateKorean(dateStr, timeStr) {
        const [year, month, day] = dateStr.split('-');
        const timeKorean = TIME_MAP[timeStr] || '';

        if (!timeKorean) {
            return `${year}ë…„ ${parseInt(month)}ì›” ${parseInt(day)}ì¼ ë¯¸ìƒ`;
        }
        return `${year}ë…„ ${parseInt(month)}ì›” ${parseInt(day)}ì¼ ${timeKorean}ì‹œ`;
    }

    // ì‚¬ì£¼íŒ”ì í‘œ ë Œë”ë§
    function renderSajuTable() {
        document.getElementById('sajuTableTitle').textContent = `${sajuData.name}ë‹˜ì˜ ì‚¬ì£¼`;
        document.getElementById('sajuTableSubtitle').textContent =
            formatBirthdateKorean(sajuData.birthdate, sajuData.birthTime);

        const tbody = document.getElementById('sajuTableBody');
        const rows = [
            { label: 'åæ˜Ÿ<br>(ì‹­ì„±)', data: sajuData.pillars.sipsung || [] },
            { label: 'å¤©å¹²<br>(ì²œê°„)', data: sajuData.pillars.cheongan || [], isChar: true },
            { label: 'åœ°æ”¯<br>(ì§€ì§€)', data: sajuData.pillars.jiji || [], isChar: true },
            { label: 'åæ˜Ÿ<br>(ì‹­ì„±)', data: sajuData.pillars.sipsung_jiji || [] },
            { label: 'åäºŒé‹æ˜Ÿ<br>(ì‹­ì´ìš´ì„±)', data: sajuData.pillars.sipiunsung || [] }
        ];

        // ì‹ ì‚´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¶”ê°€
        if (sajuData.pillars.sinsal && sajuData.pillars.sinsal.length > 0) {
            rows.push({ label: 'ç¥æ®º<br>(ì‹ ì‚´)', data: sajuData.pillars.sinsal });
        }

        rows.forEach(row => {
            if (!row.data || row.data.length === 0) return; // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td style="background: #f8f9fa; font-weight: 600;">${row.label}</td>
                ${row.data.map(item => {
                    if (row.isChar && item) {
                        const ohangType = OHANG_MAP[item] || '';
                        // ì§€ì§€ì¸ ê²½ìš° í•œê¸€ ë°œìŒ ì¶”ê°€
                        if (row.label.includes('ì§€ì§€') && JIJI_PRONUNCIATION[item]) {
                            return `<td><span class="saju-char ohang-${ohangType}">${item}<br><small style="font-size:12px; font-weight:400;">(${JIJI_PRONUNCIATION[item]})</small></span></td>`;
                        }
                        return `<td><span class="saju-char ohang-${ohangType}">${item}</span></td>`;
                    } else if (row.label.includes('ì‹­ì´ìš´ì„±') && item && SIPIUNSUNG_KOREAN[item]) {
                        // ì‹­ì´ìš´ì„±ì— í•œê¸€ ì´ë¦„ ì¶”ê°€
                        return `<td>${item}<br><small style="font-size:12px; color:#666;">(${SIPIUNSUNG_KOREAN[item]})</small></td>`;
                    } else {
                        return `<td>${item || '(ì—†ìŒ)'}</td>`;
                    }
                }).join('')}
            `;
            tbody.appendChild(tr);
        });
    }

    // ëŒ€ìš´í‘œ ë Œë”ë§
    function renderDaeun() {
        document.getElementById('daeunTitle').textContent = `${sajuData.name}ë‹˜ì˜ ëŒ€ìš´í‘œ`;

        const tableContainer = document.getElementById('daeunTable');
        const subtitleEl = document.getElementById('daeunSubtitle');

        if (sajuData.daeun && sajuData.daeun.periods && sajuData.daeun.periods.length > 0) {
            const startAge = sajuData.daeun.start_age || 0;
            subtitleEl.textContent = `${sajuData.name}ë‹˜ì˜ ëŒ€ìš´ì£¼ê¸°ëŠ” ${startAge}ì„¸ë¶€í„° ì‹œì‘í•´ 10ë…„ ì£¼ê¸°ë¡œ ì°¾ì•„ì™€ìš”`;

            const table = document.createElement('table');

            // í—¤ë”
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th>ëŒ€ìš´</th>';

            sajuData.daeun.periods.forEach(period => {
                headerRow.innerHTML += `<th>${period.gan || ''}${period.ji || ''}</th>`;
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // ë°”ë”” - ë…„ë„
            const tbody = document.createElement('tbody');
            const yearRow = document.createElement('tr');
            yearRow.innerHTML = '<td style="background: #f8f9fa; font-weight: 600;">ë…„ë„</td>';
            sajuData.daeun.periods.forEach(period => {
                yearRow.innerHTML += `<td>${period.year}ë…„</td>`;
            });
            tbody.appendChild(yearRow);

            // ë‚˜ì´
            const ageRow = document.createElement('tr');
            ageRow.innerHTML = '<td style="background: #f8f9fa; font-weight: 600;">ë‚˜ì´</td>';
            sajuData.daeun.periods.forEach(period => {
                ageRow.innerHTML += `<td>${period.age}ì„¸</td>`;
            });
            tbody.appendChild(ageRow);

            table.appendChild(tbody);
            tableContainer.appendChild(table);
        } else {
            subtitleEl.textContent = 'ëŒ€ìš´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
        }
    }

    // ì˜¤í–‰ ì°¨íŠ¸ ë Œë”ë§
    function renderOhang() {
        const diagram = document.getElementById('ohangCycleDiagram');

        // ì˜¤í–‰ ë°ì´í„° êµ¬ì„±
        const elements = {
            wood: { name: 'æœ¨', count: sajuData.ohang['æœ¨'] ? sajuData.ohang['æœ¨'].count : 0 },
            fire: { name: 'ç«', count: sajuData.ohang['ç«'] ? sajuData.ohang['ç«'].count : 0 },
            earth: { name: 'åœŸ', count: sajuData.ohang['åœŸ'] ? sajuData.ohang['åœŸ'].count : 0 },
            metal: { name: 'é‡‘', count: sajuData.ohang['é‡‘'] ? sajuData.ohang['é‡‘'].count : 0 },
            water: { name: 'æ°´', count: sajuData.ohang['æ°´'] ? sajuData.ohang['æ°´'].count : 0 }
        };

        // ë‹¤ì´ì–´ê·¸ë¨ í¬ê¸°ì— ë”°ë¥¸ ë™ì  ìœ„ì¹˜ ê³„ì‚°
        const diagramSize = 500;  // SVG viewBox í¬ê¸°
        const centerX = diagramSize / 2;
        const centerY = diagramSize / 2;
        const radius = diagramSize * 0.35;  // ì¤‘ì‹¬ì—ì„œ ì›ì†Œê¹Œì§€ì˜ ê±°ë¦¬

        // ìš”ì†Œ ìœ„ì¹˜ (5ê°í˜• ë°°ì¹˜, æœ¨ì´ ìœ„)
        const positions = {
            wood:  { x: centerX, y: centerY - radius },                           // ìƒë‹¨
            fire:  { x: centerX + radius * 0.95, y: centerY - radius * 0.31 },    // ìš°ìƒ
            earth: { x: centerX + radius * 0.59, y: centerY + radius * 0.81 },    // ìš°í•˜
            metal: { x: centerX - radius * 0.59, y: centerY + radius * 0.81 },    // ì¢Œí•˜
            water: { x: centerX - radius * 0.95, y: centerY - radius * 0.31 }     // ì¢Œìƒ
        };

        // SVG ìƒì„±
        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('class', 'cycle-svg');
        svg.setAttribute('viewBox', '0 0 500 500');

        // í™”ì‚´í‘œ ë§ˆì»¤ ì •ì˜
        const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');

        // ìƒ í™”ì‚´í‘œ ë§ˆì»¤ (íŒŒë€ìƒ‰)
        const markerSheng = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
        markerSheng.setAttribute('id', 'arrowhead-sheng');
        markerSheng.setAttribute('markerWidth', '10');
        markerSheng.setAttribute('markerHeight', '10');
        markerSheng.setAttribute('refX', '8');
        markerSheng.setAttribute('refY', '3');
        markerSheng.setAttribute('orient', 'auto');
        const pathSheng = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        pathSheng.setAttribute('d', 'M0,0 L0,6 L9,3 z');
        pathSheng.setAttribute('fill', '#2563eb');
        markerSheng.appendChild(pathSheng);
        defs.appendChild(markerSheng);

        // ê·¹ í™”ì‚´í‘œ ë§ˆì»¤ (ë¹¨ê°„ìƒ‰)
        const markerKe = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
        markerKe.setAttribute('id', 'arrowhead-ke');
        markerKe.setAttribute('markerWidth', '10');
        markerKe.setAttribute('markerHeight', '10');
        markerKe.setAttribute('refX', '8');
        markerKe.setAttribute('refY', '3');
        markerKe.setAttribute('orient', 'auto');
        const pathKe = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        pathKe.setAttribute('d', 'M0,0 L0,6 L9,3 z');
        pathKe.setAttribute('fill', '#dc2626');
        markerKe.appendChild(pathKe);
        defs.appendChild(markerKe);

        svg.appendChild(defs);

        // ìƒ í™”ì‚´í‘œ ê·¸ë¦¬ê¸° (æ°´â†’æœ¨â†’ç«â†’åœŸâ†’é‡‘â†’æ°´)
        const shengCycle = [
            { from: 'water', to: 'wood' },
            { from: 'wood', to: 'fire' },
            { from: 'fire', to: 'earth' },
            { from: 'earth', to: 'metal' },
            { from: 'metal', to: 'water' }
        ];

        // í™”ì‚´í‘œë¥¼ ë” ì§§ê²Œ ë§Œë“¤ê¸° ìœ„í•œ í•¨ìˆ˜
        function shortenLine(fromPos, toPos, startOffset, endOffset) {
            const dx = toPos.x - fromPos.x;
            const dy = toPos.y - fromPos.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const unitX = dx / length;
            const unitY = dy / length;

            return {
                start: {
                    x: fromPos.x + unitX * startOffset,
                    y: fromPos.y + unitY * startOffset
                },
                end: {
                    x: toPos.x - unitX * endOffset,
                    y: toPos.y - unitY * endOffset
                }
            };
        }

        shengCycle.forEach(({ from, to }) => {
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const fromPos = positions[from];
            const toPos = positions[to];

            // í™”ì‚´í‘œë¥¼ ì›ì˜ ê°€ì¥ìë¦¬ì—ì„œ ì‹œì‘/ëë‚˜ë„ë¡ ì¡°ì • (ë°˜ì§€ë¦„ 40px)
            const shortened = shortenLine(fromPos, toPos, 45, 45);

            // ê³¡ì„  ê²½ë¡œ ê³„ì‚°
            const midX = (shortened.start.x + shortened.end.x) / 2;
            const midY = (shortened.start.y + shortened.end.y) / 2;
            const curveOffset = 15;

            path.setAttribute('d', `M ${shortened.start.x} ${shortened.start.y} Q ${midX + curveOffset} ${midY - curveOffset} ${shortened.end.x} ${shortened.end.y}`);
            path.setAttribute('class', 'sheng-arrow');
            svg.appendChild(path);
        });

        // ê·¹ í™”ì‚´í‘œ ê·¸ë¦¬ê¸° (æ°´â†’ç«â†’é‡‘â†’æœ¨â†’åœŸâ†’æ°´) - ì˜¤ê°í˜•
        const keCycle = [
            { from: 'water', to: 'fire' },
            { from: 'fire', to: 'metal' },
            { from: 'metal', to: 'wood' },
            { from: 'wood', to: 'earth' },
            { from: 'earth', to: 'water' }
        ];

        keCycle.forEach(({ from, to }) => {
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const fromPos = positions[from];
            const toPos = positions[to];

            // í™”ì‚´í‘œë¥¼ ì›ì˜ ê°€ì¥ìë¦¬ì—ì„œ ì‹œì‘/ëë‚˜ë„ë¡ ì¡°ì •
            const shortened = shortenLine(fromPos, toPos, 45, 45);

            path.setAttribute('d', `M ${shortened.start.x} ${shortened.start.y} L ${shortened.end.x} ${shortened.end.y}`);
            path.setAttribute('class', 'ke-arrow');
            svg.appendChild(path);
        });

        diagram.appendChild(svg);

        // ì˜¤í–‰ ì› ìƒì„±
        Object.keys(elements).forEach(type => {
            const elem = elements[type];
            const div = document.createElement('div');
            div.className = `ohang-element ${type}`;
            div.innerHTML = `
                ${elem.name}
                <div class="count">${elem.count}ê°œ</div>
            `;
            diagram.appendChild(div);
        });

        // ì˜¤í–‰ ë¹„ìœ¨ ê·¸ë˜í”„ ë Œë”ë§
        const ratioGraph = document.getElementById('ohangRatioGraph');
        const ohangOrder = [
            { key: 'æœ¨', name: 'ëª©', type: 'wood' },
            { key: 'ç«', name: 'í™”', type: 'fire' },
            { key: 'åœŸ', name: 'í† ', type: 'earth' },
            { key: 'é‡‘', name: 'ê¸ˆ', type: 'metal' },
            { key: 'æ°´', name: 'ìˆ˜', type: 'water' }
        ];

        ohangOrder.forEach(({ key, name, type }) => {
            const ohangInfo = sajuData.ohang[key] || { count: 0, percent: 0 };
            const itemDiv = document.createElement('div');
            itemDiv.className = 'ohang-ratio-item';
            itemDiv.innerHTML = `
                <div class="ohang-ratio-label">
                    <span class="ohang-ratio-label-hanja">${key}</span>
                    <span>${name}</span>
                </div>
                <div class="ohang-ratio-bar-wrapper">
                    <div class="ohang-ratio-bar ${type}" style="width: ${ohangInfo.percent || 0}%">
                        ${ohangInfo.percent ? ohangInfo.percent.toFixed(1) + '%' : ''}
                    </div>
                </div>
            `;
            ratioGraph.appendChild(itemDiv);
        });

        // ìš©ì‹  ì„¹ì…˜ ë Œë”ë§
        const yongsinContainer = document.getElementById('yongsinContainer');
        console.log('Yongsin data:', sajuData.yongsin); // ë””ë²„ê¹…ìš©

        if (sajuData.yongsin && sajuData.yongsin.yongsin) {
            const yongsinData = [
                {
                    label: 'ìš©ì‹ ',
                    value: sajuData.yongsin.yongsin,
                    tooltip: 'ìš©ì‹ ì´ë€? ì‚¬ì£¼ì˜ ê· í˜•ì„ ë§ì¶°ì£¼ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ì˜¤í–‰ìœ¼ë¡œ, ë¶€ì¡±í•œ ê¸°ìš´ì„ ì±„ì›Œì£¼ê±°ë‚˜ ê³¼í•œ ê¸°ìš´ì„ ì¡°ì ˆí•©ë‹ˆë‹¤.'
                },
                {
                    label: 'í¬ì‹ ',
                    value: sajuData.yongsin.heesin,
                    tooltip: 'í¬ì‹ ì´ë€? ìš©ì‹ ì„ ë„ì™€ì£¼ëŠ” ì˜¤í–‰ìœ¼ë¡œ, ìš©ì‹ ì˜ í˜ì„ ê°•í™”ì‹œì¼œ ì‚¬ì£¼ì˜ ê· í˜•ì„ ë”ìš± ì•ˆì •ì ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.'
                },
                {
                    label: 'ê¸°ì‹ ',
                    value: sajuData.yongsin.gisin,
                    tooltip: 'ê¸°ì‹ ì´ë€? ì‚¬ì£¼ì˜ ê· í˜•ì„ í•´ì¹˜ëŠ” ì˜¤í–‰ìœ¼ë¡œ, ì´ ê¸°ìš´ì´ ê°•í•˜ë©´ ìš´ì´ ë¶ˆì•ˆì •í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                }
            ];

            // íƒ€ì´í‹€ ì¶”ê°€
            const titleDiv = document.createElement('div');
            titleDiv.className = 'yongsin-title-wrapper';
            titleDiv.innerHTML = '<h3 class="yongsin-main-title">ìš©ì‹  ë¶„ì„</h3>';
            yongsinContainer.appendChild(titleDiv);

            // ê·¸ë¦¬ë“œ ìƒì„±
            const gridDiv = document.createElement('div');
            gridDiv.className = 'yongsin-grid';

            yongsinData.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'yongsin-item';

                // ê°’ì´ ìˆì„ ë•Œë§Œ í•œì ë§¤í•‘ ì‹œë„
                let hanjaInfo;
                if (item.value && item.value !== '-' && item.value !== '') {
                    hanjaInfo = OHANG_HANJA_MAP[item.value] || { hanja: item.value, hangul: '-' };
                } else {
                    hanjaInfo = { hanja: '-', hangul: '-' };
                }

                console.log(`${item.label}: ${item.value} -> ${hanjaInfo.hanja} (${hanjaInfo.hangul})`); // ë””ë²„ê¹…ìš©

                itemDiv.innerHTML = `
                    <div class="yongsin-label-wrapper">
                        <span class="yongsin-label">${item.label}</span>
                        <span class="help-icon">
                            ?
                            <span class="tooltip">${item.tooltip}</span>
                        </span>
                    </div>
                    <div class="yongsin-circle">
                        <div class="yongsin-hanja">${hanjaInfo.hanja}</div>
                    </div>
                    <div class="yongsin-hangul">${hanjaInfo.hangul}</div>
                `;
                gridDiv.appendChild(itemDiv);
            });

            yongsinContainer.appendChild(gridDiv);
        } else {
            // ìš©ì‹  ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°
            yongsinContainer.innerHTML = '<p style="text-align: center; color: #8b7355;">ìš©ì‹  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ì‹ ê°•ì‹ ì•½ ë§ˆì»¤
        if (sajuData.strength && sajuData.strength.position !== undefined) {
            const marker = document.getElementById('strengthMarker');
            marker.style.left = `${sajuData.strength.position}%`;
            const dayGan = sajuData.pillars.cheongan && sajuData.pillars.cheongan[1] ? sajuData.pillars.cheongan[1] : '?';
            document.getElementById('strengthResult').textContent =
                `ì¼ê°„ '${dayGan}', '${sajuData.strength.level || 'ì¤‘í™”'}'í•œ ì‚¬ì£¼ì…ë‹ˆë‹¤`;
        }
    }

    // ìš´ì„¸ í…ìŠ¤íŠ¸ ë Œë”ë§
    function renderFortune() {
        const lines = fortuneText.split('\n');
        const sections = [];
        let currentSection = null;

        for (let line of lines) {
            line = line.trim();
            if (!line) continue;

            const headerMatch = line.match(/^\*\*(.+?)\*\*$/);
            if (headerMatch) {
                if (currentSection) {
                    sections.push(currentSection);
                }

                let title = headerMatch[1].trim();
                title = title.replace(/^\d+\.\s*/, '');

                currentSection = {
                    title: title,
                    content: ''
                };
            } else if (currentSection) {
                currentSection.content += line + '\n';
            }
        }

        if (currentSection) {
            sections.push(currentSection);
        }

        const container = document.getElementById('fortuneContent');
        let html = '';

        sections.forEach((section, index) => {
            if (index === 0) return; // ì¸ì‚¬ë§ ìŠ¤í‚µ

            const icons = {
                'ì „ì²´ì ì¸ ì„±ê²©ê³¼ íŠ¹ì§•': 'ğŸ­',
                '2025ë…„ ìš´ì„¸': 'ğŸ“…',
                'ì§ì—…ìš´ê³¼ ì¬ë¬¼ìš´': 'ğŸ’¼',
                'ì—°ì• ìš´ê³¼ ê²°í˜¼ìš´': 'ğŸ’–',
                'ê±´ê°•ìš´': 'ğŸ’ª',
                'í•œ ì¤„ ì¡°ì–¸': 'ğŸ’¡'
            };

            let icon = 'âœ¨';
            for (const [key, value] of Object.entries(icons)) {
                if (section.title.includes(key)) {
                    icon = value;
                    break;
                }
            }

            html += `
                <div class="fortune-card">
                    <div class="fortune-card-header">
                        <div class="fortune-card-icon">${icon}</div>
                        <h3 class="fortune-card-title">${section.title}</h3>
                    </div>
                    <div class="fortune-card-content">
                        ${formatContent(section.content)}
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
    }

    function formatContent(content) {
        const lines = content.split('\n').map(line => line.trim()).filter(line => line);
        let html = '';

        for (const line of lines) {
            let processedLine = line.replace(/^-\s*/, '');
            processedLine = processedLine.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html += `<p style="margin-bottom: 12px; line-height: 1.8;">${processedLine}</p>`;
        }

        return html;
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
    renderSajuTable();
    renderDaeun();
    renderOhang();
    renderFortune();

    // ===== SNS ê³µìœ  ê¸°ëŠ¥ =====

</script>
{% endblock %}
