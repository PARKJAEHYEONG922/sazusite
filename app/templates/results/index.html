{% extends "layout/base.html" %}

{% block title %}{{ site_config.site_name if site_config else "ëª…ì›”í—Œ" }} - ì•¼ê´‘ë¬˜ê°€ ì•Œë ¤ì£¼ëŠ” ì˜¤ëŠ˜ì˜ ê¸°ìš´{% endblock %}

{% block meta_description %}ëª…ì›”í—Œ - ì „í†µ ì‚¬ì£¼íŒ”ì, 2026ë…„ ì‹ ë…„ìš´ì„¸, ì‚¬ì£¼ê¶í•©, ì˜¤ëŠ˜ì˜ ìš´ì„¸, ê¿ˆí•´ëª½. 30ë…„ ê²½ë ¥ ëª…ë¦¬í•™ìì˜ ì •í™•í•œ ìš´ì„¸ í’€ì´ë¥¼ AIë¡œ ë§Œë‚˜ë³´ì„¸ìš”. ë¬´ë£Œ ìš´ì„¸ ìƒë‹´.{% endblock %}

{% block meta_keywords %}ì‚¬ì£¼, ì‚¬ì£¼íŒ”ì, ì‹ ë…„ìš´ì„¸, 2026ë…„ ìš´ì„¸, ê¶í•©, ì‚¬ì£¼ê¶í•©, ê¿ˆí•´ëª½, ì˜¤ëŠ˜ì˜ ìš´ì„¸, ëª…ë¦¬í•™, ìš´ì„¸, ë¬´ë£Œìš´ì„¸, íƒ€ë¡œ, ë ë³„ìš´ì„¸{% endblock %}

{% block og_type %}website{% endblock %}

{% block og_image %}{{ site_config.banner_image_1 if site_config and site_config.banner_image_1 else url_for('static', path='/images/og-home.jpg') }}{% endblock %}

{% block content %}
<!-- ë©”ì¸ ë°°ë„ˆ ìŠ¬ë¼ì´ë” (ì „ì²´ ë„ˆë¹„) -->
<section class="banner-section">
    <div class="swiper-container" id="mainBanner">
        <div class="swiper-wrapper">
            <!-- ìŠ¬ë¼ì´ë“œ 1 -->
            <div class="swiper-slide">
                <picture>
                    {% if site_config and site_config.banner_image_pc_1 %}
                    <source media="(min-width: 768px)" srcset="{{ site_config.banner_image_pc_1 }}">
                    {% endif %}
                    {% if site_config and site_config.banner_image_1 %}
                    <img src="{{ site_config.banner_image_1 }}" alt="{{ site_config.banner_title_1 if site_config else 'ì˜¤ëŠ˜ì˜ ìš´ì„¸' }}">
                    {% else %}
                    <img src="https://via.placeholder.com/1200x900/3498db/ffffff?text=ì˜¤ëŠ˜ì˜+ìš´ì„¸" alt="ì˜¤ëŠ˜ì˜ ìš´ì„¸">
                    {% endif %}
                </picture>
                <div class="slide-content">
                    <h2>{{ site_config.banner_title_1 if site_config and site_config.banner_title_1 else 'ì˜¤ëŠ˜ì˜ ìš´ì„¸' }}</h2>
                    <p>{{ site_config.banner_subtitle_1 if site_config and site_config.banner_subtitle_1 else 'ì•¼ê´‘ë¬˜ê°€ ì˜¤ëŠ˜ì˜ ê¸°ìš´ì„ ì½ì–´ë“œë¦½ë‹ˆë‹¤' }}</p>
                    {% if site_config and site_config.banner_description_1 %}
                    <p style="font-size: 1.05rem; margin-top: 0.5rem; opacity: 0.95;">{{ site_config.banner_description_1 }}</p>
                    {% endif %}
                    <a href="{{ site_config.banner_link_1 if site_config and site_config.banner_link_1 else '/fortune/today' }}" class="banner-btn">ì§€ê¸ˆ ë³´ëŸ¬ê°€ê¸° â†’</a>
                </div>
            </div>

            <!-- ìŠ¬ë¼ì´ë“œ 2 -->
            <div class="swiper-slide">
                <picture>
                    {% if site_config and site_config.banner_image_pc_2 %}
                    <source media="(min-width: 768px)" srcset="{{ site_config.banner_image_pc_2 }}">
                    {% endif %}
                    {% if site_config and site_config.banner_image_2 %}
                    <img src="{{ site_config.banner_image_2 }}" alt="{{ site_config.banner_title_2 if site_config else 'ì •í†µ ì‚¬ì£¼íŒ”ì' }}">
                    {% else %}
                    <img src="https://via.placeholder.com/1200x900/9b59b6/ffffff?text=ì •í†µ+ì‚¬ì£¼íŒ”ì" alt="ì •í†µ ì‚¬ì£¼íŒ”ì">
                    {% endif %}
                </picture>
                <div class="slide-content">
                    <h2>{{ site_config.banner_title_2 if site_config and site_config.banner_title_2 else 'ì •í†µ ì‚¬ì£¼íŒ”ì' }}</h2>
                    <p>{{ site_config.banner_subtitle_2 if site_config and site_config.banner_subtitle_2 else 'ì²­ì›”ì•„ì”¨ê°€ ì‚¬ì£¼ í•œì í•œì ì§šì–´ë“œë¦½ë‹ˆë‹¤' }}</p>
                    {% if site_config and site_config.banner_description_2 %}
                    <p style="font-size: 1.05rem; margin-top: 0.5rem; opacity: 0.95;">{{ site_config.banner_description_2 }}</p>
                    {% endif %}
                    <a href="{{ site_config.banner_link_2 if site_config and site_config.banner_link_2 else '/fortune/saju' }}" class="banner-btn">ì§€ê¸ˆ ë³´ëŸ¬ê°€ê¸° â†’</a>
                </div>
            </div>

            <!-- ìŠ¬ë¼ì´ë“œ 3 -->
            <div class="swiper-slide">
                <picture>
                    {% if site_config and site_config.banner_image_pc_3 %}
                    <source media="(min-width: 768px)" srcset="{{ site_config.banner_image_pc_3 }}">
                    {% endif %}
                    {% if site_config and site_config.banner_image_3 %}
                    <img src="{{ site_config.banner_image_3 }}" alt="{{ site_config.banner_title_3 if site_config else 'ì‚¬ì£¼ê¶í•©' }}">
                    {% else %}
                    <img src="https://via.placeholder.com/1200x900/e74c3c/ffffff?text=ì‚¬ì£¼ê¶í•©" alt="ì‚¬ì£¼ê¶í•©">
                    {% endif %}
                </picture>
                <div class="slide-content">
                    <h2>{{ site_config.banner_title_3 if site_config and site_config.banner_title_3 else 'ì‚¬ì£¼ê¶í•©' }}</h2>
                    <p>{{ site_config.banner_subtitle_3 if site_config and site_config.banner_subtitle_3 else 'ì›”í•˜ë‚­ìê°€ ë¶‰ì€ ì‹¤ì„ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤' }}</p>
                    {% if site_config and site_config.banner_description_3 %}
                    <p style="font-size: 1.05rem; margin-top: 0.5rem; opacity: 0.95;">{{ site_config.banner_description_3 }}</p>
                    {% endif %}
                    <a href="{{ site_config.banner_link_3 if site_config and site_config.banner_link_3 else '/fortune/match' }}" class="banner-btn">ì§€ê¸ˆ ë³´ëŸ¬ê°€ê¸° â†’</a>
                </div>
            </div>

            <!-- ìŠ¬ë¼ì´ë“œ 4 -->
            <div class="swiper-slide">
                <picture>
                    {% if site_config and site_config.banner_image_pc_4 %}
                    <source media="(min-width: 768px)" srcset="{{ site_config.banner_image_pc_4 }}">
                    {% endif %}
                    {% if site_config and site_config.banner_image_4 %}
                    <img src="{{ site_config.banner_image_4 }}" alt="{{ site_config.banner_title_4 if site_config else 'ê¿ˆí•´ëª½' }}">
                    {% else %}
                    <img src="https://via.placeholder.com/1200x900/1abc9c/ffffff?text=ê¿ˆí•´ëª½" alt="ê¿ˆí•´ëª½">
                    {% endif %}
                </picture>
                <div class="slide-content">
                    <h2>{{ site_config.banner_title_4 if site_config and site_config.banner_title_4 else 'ê¿ˆí•´ëª½' }}</h2>
                    <p>{{ site_config.banner_subtitle_4 if site_config and site_config.banner_subtitle_4 else 'ë°±ìš´ì„ ìƒì´ ê¿ˆì† ë©”ì‹œì§€ë¥¼ í’€ì–´ë“œë¦½ë‹ˆë‹¤' }}</p>
                    {% if site_config and site_config.banner_description_4 %}
                    <p style="font-size: 1.05rem; margin-top: 0.5rem; opacity: 0.95;">{{ site_config.banner_description_4 }}</p>
                    {% endif %}
                    <a href="{{ site_config.banner_link_4 if site_config and site_config.banner_link_4 else '/fortune/dream' }}" class="banner-btn">ì§€ê¸ˆ ë³´ëŸ¬ê°€ê¸° â†’</a>
                </div>
            </div>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="swiper-pagination"></div>
    </div>
</section>

<!-- ìš´ì„¸ ì„œë¹„ìŠ¤ ì„¹ì…˜ -->
<section class="services-section">
    <div class="container">
        <h2 class="section-title">ëª…ì›”í—Œ BEST ì‚¬ì£¼</h2>

        <div class="services-grid">
            <!-- ì„œë¸Œë°°ë„ˆ 1 -->
            <a href="{{ site_config.sub_banner_link_1 if site_config and site_config.sub_banner_link_1 else '/fortune/newyear2026' }}" class="service-card">
                <div class="service-image">
                    {% if site_config and site_config.sub_banner_image_1 %}
                        {% if site_config.sub_banner_image_1.endswith(('.mp4', '.webm')) or '.mp4?' in site_config.sub_banner_image_1 or '.webm?' in site_config.sub_banner_image_1 %}
                        <video autoplay loop muted playsinline>
                            <source src="{{ site_config.sub_banner_image_1 }}" type="video/{{ 'mp4' if '.mp4' in site_config.sub_banner_image_1 else 'webm' }}">
                        </video>
                        {% else %}
                        <img src="{{ site_config.sub_banner_image_1 }}" alt="{{ site_config.sub_banner_title_1 }}">
                        {% endif %}
                    {% else %}
                    <div class="service-placeholder">
                        <span class="service-emoji">{{ site_config.sub_banner_emoji_1 if site_config else 'ğŸŒ™' }}</span>
                    </div>
                    {% endif %}
                    <h3 class="service-title">{{ site_config.sub_banner_title_1 if site_config else '2026 ì‹ ë…„ìš´ì„¸' }}</h3>
                </div>
                <div class="service-content">
                    <p class="service-subtitle">{{ site_config.sub_banner_subtitle_1 if site_config else 'ì•¼ê´‘ë¬˜ê°€ í¼ì³ë“œë ¤ìš”' }}</p>
                    <p class="service-description">{{ site_config.sub_banner_description_1 if site_config else '2026ë…„ ê°‘ì˜¤ë…„(ç”²åˆå¹´), í•œ í•´ ìš´ì„¸ë¥¼ ë¯¸ë¦¬ ì‚´í´ë³´ì„¸ìš”' }}</p>
                </div>
            </a>

            <!-- ì„œë¸Œë°°ë„ˆ 2 -->
            <a href="{{ site_config.sub_banner_link_2 if site_config and site_config.sub_banner_link_2 else '/fortune/saju' }}" class="service-card">
                <div class="service-image">
                    {% if site_config and site_config.sub_banner_image_2 %}
                        {% if site_config.sub_banner_image_2.endswith(('.mp4', '.webm')) or '.mp4?' in site_config.sub_banner_image_2 or '.webm?' in site_config.sub_banner_image_2 %}
                        <video autoplay loop muted playsinline>
                            <source src="{{ site_config.sub_banner_image_2 }}" type="video/{{ 'mp4' if '.mp4' in site_config.sub_banner_image_2 else 'webm' }}">
                        </video>
                        {% else %}
                        <img src="{{ site_config.sub_banner_image_2 }}" alt="{{ site_config.sub_banner_title_2 }}">
                        {% endif %}
                    {% else %}
                    <div class="service-placeholder">
                        <span class="service-emoji">{{ site_config.sub_banner_emoji_2 if site_config else 'ğŸ“œ' }}</span>
                    </div>
                    {% endif %}
                    <h3 class="service-title">{{ site_config.sub_banner_title_2 if site_config else 'ì •í†µ ì‚¬ì£¼íŒ”ì' }}</h3>
                </div>
                <div class="service-content">
                    <p class="service-subtitle">{{ site_config.sub_banner_subtitle_2 if site_config else 'ì²­ì›”ì•„ì”¨ê°€ ì§šì–´ë“œë ¤ìš”' }}</p>
                    <p class="service-description">{{ site_config.sub_banner_description_2 if site_config else 'íƒ€ê³ ë‚œ ìš´ëª…ì˜ íë¦„, ì¸ìƒì˜ í° ê·¸ë¦¼ì„ ë³´ì„¸ìš”' }}</p>
                </div>
            </a>

            <!-- ì„œë¸Œë°°ë„ˆ 3 -->
            <a href="{{ site_config.sub_banner_link_3 if site_config and site_config.sub_banner_link_3 else '/fortune/match' }}" class="service-card">
                <div class="service-image">
                    {% if site_config and site_config.sub_banner_image_3 %}
                        {% if site_config.sub_banner_image_3.endswith(('.mp4', '.webm')) or '.mp4?' in site_config.sub_banner_image_3 or '.webm?' in site_config.sub_banner_image_3 %}
                        <video autoplay loop muted playsinline>
                            <source src="{{ site_config.sub_banner_image_3 }}" type="video/{{ 'mp4' if '.mp4' in site_config.sub_banner_image_3 else 'webm' }}">
                        </video>
                        {% else %}
                        <img src="{{ site_config.sub_banner_image_3 }}" alt="{{ site_config.sub_banner_title_3 }}">
                        {% endif %}
                    {% else %}
                    <div class="service-placeholder">
                        <span class="service-emoji">{{ site_config.sub_banner_emoji_3 if site_config else 'ğŸ’˜' }}</span>
                    </div>
                    {% endif %}
                    <h3 class="service-title">{{ site_config.sub_banner_title_3 if site_config else 'ì‚¬ì£¼ê¶í•©' }}</h3>
                </div>
                <div class="service-content">
                    <p class="service-subtitle">{{ site_config.sub_banner_subtitle_3 if site_config else 'ì›”í•˜ë‚­ìê°€ ë§ºì–´ë“œë ¤ìš”' }}</p>
                    <p class="service-description">{{ site_config.sub_banner_description_3 if site_config else 'ë‘ ì‚¬ëŒì˜ íŒ”ìê°€ ë§Œë‚˜ ë¹šì–´ë‚¼ ìš´ëª…ì„ ì‚´í´ë³´ì„¸ìš”' }}</p>
                </div>
            </a>

            <!-- ì„œë¸Œë°°ë„ˆ 4 -->
            <a href="{{ site_config.sub_banner_link_4 if site_config and site_config.sub_banner_link_4 else '/fortune/dream' }}" class="service-card">
                <div class="service-image">
                    {% if site_config and site_config.sub_banner_image_4 %}
                        {% if site_config.sub_banner_image_4.endswith(('.mp4', '.webm')) or '.mp4?' in site_config.sub_banner_image_4 or '.webm?' in site_config.sub_banner_image_4 %}
                        <video autoplay loop muted playsinline>
                            <source src="{{ site_config.sub_banner_image_4 }}" type="video/{{ 'mp4' if '.mp4' in site_config.sub_banner_image_4 else 'webm' }}">
                        </video>
                        {% else %}
                        <img src="{{ site_config.sub_banner_image_4 }}" alt="{{ site_config.sub_banner_title_4 }}">
                        {% endif %}
                    {% else %}
                    <div class="service-placeholder">
                        <span class="service-emoji">{{ site_config.sub_banner_emoji_4 if site_config else 'ğŸ’­' }}</span>
                    </div>
                    {% endif %}
                    <h3 class="service-title">{{ site_config.sub_banner_title_4 if site_config else 'ê¿ˆí•´ëª½' }}</h3>
                </div>
                <div class="service-content">
                    <p class="service-subtitle">{{ site_config.sub_banner_subtitle_4 if site_config else 'ë°±ìš´ì„ ìƒì´ ê¿ˆì† ë©”ì‹œì§€ë¥¼ í’€ì–´ë“œë¦½ë‹ˆë‹¤' }}</p>
                    <p class="service-description">{{ site_config.sub_banner_description_4 if site_config else 'ê¿ˆì€ ë˜ ë‹¤ë¥¸ ì„¸ê³„ì˜ ì•”í˜¸, ê·¸ ì˜ë¯¸ë¥¼ ì°¾ì•„ë³´ì„¸ìš”' }}</p>
                </div>
            </a>
        </div>
    </div>
</section>

<!-- ë¹ ë¥¸ ìš´ì„¸ ë³´ê¸° ì„¹ì…˜ -->
<section class="quick-fortune-section">
    <div class="container">
        <h2 class="section-title">
            {{ site_config.quick_fortune_title if site_config else "ë¹ ë¥¸ ìš´ì„¸ ë³´ê¸°" }}
        </h2>
        <p class="text-center mb-4" style="color: var(--text-secondary);">
            {{ site_config.quick_fortune_description if site_config else "ê°„ë‹¨í•œ ì •ë³´ ì…ë ¥ìœ¼ë¡œ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”" }}
        </p>

        <form class="quick-fortune-form" action="/fortune/today" method="POST">
            <div class="form-group">
                <label for="name">ì´ë¦„ *</label>
                <input type="text" id="name" name="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>

            <div class="form-group">
                <div class="label-with-calendar">
                    <label for="birthdate">ìƒë…„ì›”ì¼ *</label>
                    <div class="calendar-buttons">
                        <button type="button" class="calendar-btn active" data-calendar="solar">
                            <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M8 16C10.1217 16 12.1566 15.1571 13.6569 13.6569C15.1571 12.1566 16 10.1217 16 8C16 5.87827 15.1571 3.84344 13.6569 2.34315C12.1566 0.842855 10.1217 0 8 0C5.87827 0 3.84344 0.842855 2.34315 2.34315C0.842855 3.84344 0 5.87827 0 8C0 10.1217 0.842855 12.1566 2.34315 13.6569C3.84344 15.1571 5.87827 16 8 16ZM11.707 6.707C11.8892 6.5184 11.99 6.2658 11.9877 6.0036C11.9854 5.7414 11.8802 5.49059 11.6948 5.30518C11.5094 5.11977 11.2586 5.0146 10.9964 5.01233C10.7342 5.01005 10.4816 5.11084 10.293 5.293L7 8.586L5.707 7.293C5.5184 7.11084 5.2658 7.01005 5.0036 7.01233C4.7414 7.0146 4.49059 7.11977 4.30518 7.30518C4.11977 7.49059 4.0146 7.7414 4.01233 8.0036C4.01005 8.2658 4.11084 8.5184 4.293 8.707L6.293 10.707C6.48053 10.8945 6.73484 10.9998 7 10.9998C7.26516 10.9998 7.51947 10.8945 7.707 10.707L11.707 6.707Z" fill="#999"></path>
                            </svg>
                            <span>ì–‘ë ¥</span>
                        </button>
                        <button type="button" class="calendar-btn" data-calendar="lunar">
                            <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="9" cy="9" r="8" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></circle>
                                <path d="M6.33333 9L8.11111 10.7778L11.6667 7.22222" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span>ìŒë ¥</span>
                        </button>
                    </div>
                </div>
                <input type="text" id="birthdate" name="birthdate" placeholder="1965.09.22" inputmode="numeric" required>
                <input type="hidden" id="birthdate_hidden" name="birthdate_actual">
                <input type="hidden" id="calendar" name="calendar" value="solar">
            </div>

            <div class="form-group">
                <label for="birth_time">íƒœì–´ë‚œ ì‹œê°„ (ì„ íƒ)</label>
                <select id="birth_time" name="birth_time">
                    <option value="">ëª¨ë¦„</option>
                    <option value="23-01">ìì‹œ (23:00-01:00)</option>
                    <option value="01-03">ì¶•ì‹œ (01:00-03:00)</option>
                    <option value="03-05">ì¸ì‹œ (03:00-05:00)</option>
                    <option value="05-07">ë¬˜ì‹œ (05:00-07:00)</option>
                    <option value="07-09">ì§„ì‹œ (07:00-09:00)</option>
                    <option value="09-11">ì‚¬ì‹œ (09:00-11:00)</option>
                    <option value="11-13">ì˜¤ì‹œ (11:00-13:00)</option>
                    <option value="13-15">ë¯¸ì‹œ (13:00-15:00)</option>
                    <option value="15-17">ì‹ ì‹œ (15:00-17:00)</option>
                    <option value="17-19">ìœ ì‹œ (17:00-19:00)</option>
                    <option value="19-21">ìˆ ì‹œ (19:00-21:00)</option>
                    <option value="21-23">í•´ì‹œ (21:00-23:00)</option>
                </select>
            </div>

            <div class="form-group">
                <label>ì„±ë³„ *</label>
                <div class="gender-buttons">
                    <button type="button" class="gender-btn" data-gender="male">
                        <span>ë‚¨ì„±</span>
                    </button>
                    <button type="button" class="gender-btn" data-gender="female">
                        <span>ì—¬ì„±</span>
                    </button>
                </div>
                <input type="hidden" id="gender" name="gender" required>
            </div>

            <button type="submit" class="btn-primary">
                ì˜¤ëŠ˜ì˜ ìš´ì„¸ ë³´ê¸° âœ¨
            </button>
        </form>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<style>
    /* ì–‘ë ¥/ìŒë ¥ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .label-with-calendar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
    }

    .calendar-buttons {
        display: flex;
        gap: 6px;
        background: #f8f9fa;
        padding: 4px;
        border-radius: 8px;
    }

    .calendar-btn {
        padding: 6px 14px;
        background: transparent;
        border: none;
        border-radius: 6px;
        color: #666666;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .calendar-btn:hover {
        color: #333333;
        background: rgba(52, 152, 219, 0.1);
    }

    .calendar-btn.active {
        background: #3498db;
        color: #ffffff;
        font-weight: 600;
    }

    .calendar-btn svg {
        display: none;
    }

    /* ì„±ë³„ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .gender-buttons {
        display: flex;
        gap: 12px;
        margin-top: 8px;
    }

    .gender-btn {
        flex: 1;
        padding: 12px;
        background: #ffffff;
        border: 1px solid #dcdcdc;
        border-radius: 8px;
        color: #333333;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .gender-btn:hover {
        background: #f8f9fa;
        border-color: #3498db;
    }

    .gender-btn.active {
        background: #3498db;
        border-color: #3498db;
        color: #ffffff;
        font-weight: 600;
    }

    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        justify-content: center;
        align-items: center;
    }

    .loading-overlay.active {
        display: flex;
    }

    .loading-content {
        text-align: center;
        padding: 40px;
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 215, 0, 0.3);
        border-radius: 20px;
        backdrop-filter: blur(10px);
    }

    .loading-emoji {
        font-size: 80px;
        animation: bounce 1s infinite;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-20px); }
    }

    .loading-text {
        font-size: 24px;
        color: #ffd700;
        margin-top: 20px;
        font-weight: bold;
    }

    .loading-subtext {
        font-size: 16px;
        color: #d4d4d4;
        margin-top: 10px;
    }

    .loading-spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255, 215, 0, 0.2);
        border-top-color: #ffd700;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-top: 20px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }
</style>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="loading-emoji">âœ¨</div>
        <div class="loading-text">ì˜¤ëŠ˜ì˜ ìš´ì„¸ë¥¼ ì¡°íšŒì¤‘ì…ë‹ˆë‹¤</div>
        <div class="loading-subtext">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
        <div class="loading-spinner"></div>
    </div>
</div>

<script>
    // Swiper ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
        new Swiper('#mainBanner', {
            slidesPerView: 1,
            spaceBetween: 0,
            loop: true,
            autoplay: {
                delay: 5000,
                disableOnInteraction: false,
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
        });

        // ë¹ ë¥¸ ìš´ì„¸ í¼ ì œì¶œ ì²˜ë¦¬
        const quickFortuneForm = document.querySelector('.quick-fortune-form');
        const submitBtn = quickFortuneForm.querySelector('.btn-primary');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const birthdateInput = document.getElementById('birthdate');

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë’¤ë¡œê°€ê¸°ë¡œ ëŒì•„ì˜¨ ê²½ìš° ì²˜ë¦¬
        window.addEventListener('pageshow', function(event) {
            // ë¸Œë¼ìš°ì € ìºì‹œì—ì„œ í˜ì´ì§€ë¥¼ ë³µì›í•œ ê²½ìš° (ë’¤ë¡œê°€ê¸°)
            if (event.persisted || performance.getEntriesByType('navigation')[0].type === 'back_forward') {
                // ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
                loadingOverlay.classList.remove('active');
                // ë²„íŠ¼ í™œì„±í™” ë° í…ìŠ¤íŠ¸ ë³µì›
                submitBtn.disabled = false;
                submitBtn.textContent = 'ì˜¤ëŠ˜ì˜ ìš´ì„¸ ë³´ê¸° âœ¨';
                // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
                sessionStorage.removeItem('fortuneFormSubmitted');
            }
        });

        // í˜ì´ì§€ë¥¼ ë– ë‚  ë•Œ (ìƒˆë¡œê³ ì¹¨ í¬í•¨) ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
        window.addEventListener('beforeunload', function() {
            if (!sessionStorage.getItem('fortuneFormSubmitted')) {
                loadingOverlay.classList.remove('active');
                submitBtn.disabled = false;
                submitBtn.textContent = 'ì˜¤ëŠ˜ì˜ ìš´ì„¸ ë³´ê¸° âœ¨';
            }
        });

        // ìƒë…„ì›”ì¼ ìë™ í¬ë§·íŒ…
        birthdateInput.addEventListener('input', function(e) {
            const input = e.target;
            let value = input.value.replace(/[^\d]/g, ''); // ìˆ«ìë§Œ ë‚¨ê¸°ê¸°

            // ìµœëŒ€ 8ìë¦¬ê¹Œì§€ë§Œ
            if (value.length > 8) {
                value = value.substring(0, 8);
            }

            // í¬ë§·íŒ…: 1989.09.22
            let formatted = '';
            if (value.length >= 4) {
                formatted = value.substring(0, 4);
                if (value.length >= 6) {
                    formatted += '.' + value.substring(4, 6);
                    if (value.length >= 8) {
                        formatted += '.' + value.substring(6, 8);
                    } else if (value.length > 6) {
                        formatted += '.' + value.substring(6);
                    }
                } else if (value.length > 4) {
                    formatted += '.' + value.substring(4);
                }
            } else {
                formatted = value;
            }

            input.value = formatted;
        });

        // ì„±ë³„ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.gender-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const gender = this.getAttribute('data-gender');

                // ê°™ì€ ê·¸ë£¹ì˜ ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                const parentButtons = this.parentElement;
                parentButtons.querySelectorAll('.gender-btn').forEach(b => {
                    b.classList.remove('active');
                });

                // í˜„ì¬ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
                this.classList.add('active');

                // hidden inputì— ê°’ ì„¤ì •
                document.getElementById('gender').value = gender;
            });
        });

        // ì–‘ë ¥/ìŒë ¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.calendar-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const calendar = this.getAttribute('data-calendar');

                // ê°™ì€ ê·¸ë£¹ì˜ ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                const parentButtons = this.parentElement;
                parentButtons.querySelectorAll('.calendar-btn').forEach(b => {
                    b.classList.remove('active');
                });

                // í˜„ì¬ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
                this.classList.add('active');

                // hidden inputì— ê°’ ì„¤ì •
                document.getElementById('calendar').value = calendar;
            });
        });

        quickFortuneForm.addEventListener('submit', function(e) {
            e.preventDefault();

            // ì´ë¦„ ìœ íš¨ì„± ê²€ì‚¬
            const nameInput = document.getElementById('name');
            if (nameInput && nameInput.value.trim()) {
                const name = nameInput.value.trim();
                // ì™„ì„±ëœ í•œê¸€ë§Œ í—ˆìš© (ììŒ/ëª¨ìŒ ë‹¨ë… ë¶ˆê°€)
                const koreanRegex = /^[ê°€-í£]+$/;
                // ììŒë§Œ ìˆëŠ”ì§€ ì²´í¬ (ã„±-ã…)
                const consonantRegex = /[ã„±-ã…]/;
                // ëª¨ìŒë§Œ ìˆëŠ”ì§€ ì²´í¬ (ã…-ã…£)
                const vowelRegex = /[ã…-ã…£]/;

                if (consonantRegex.test(name) || vowelRegex.test(name)) {
                    alert('ì™„ì„±ëœ í•œê¸€ ì´ë¦„ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    nameInput.focus();
                    return;
                }

                if (!koreanRegex.test(name)) {
                    alert('ì´ë¦„ì€ í•œê¸€ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    nameInput.focus();
                    return;
                }

                if (name.length < 2 || name.length > 4) {
                    alert('ì´ë¦„ì€ 2ê¸€ì ì´ìƒ 4ê¸€ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    nameInput.focus();
                    return;
                }
            }

            // ìƒë…„ì›”ì¼ì„ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            const birthdateValue = birthdateInput.value.replace(/\./g, '');
            if (birthdateValue.length === 8) {
                const year = parseInt(birthdateValue.substring(0, 4));
                const month = parseInt(birthdateValue.substring(4, 6));
                const day = parseInt(birthdateValue.substring(6, 8));

                // ë…„ë„ ìœ íš¨ì„± ê²€ì‚¬ (150ì‚´ ì´ìƒ ë¶ˆê°€)
                const currentYear = new Date().getFullYear();
                const minYear = currentYear - 150;
                if (year < minYear || year > currentYear) {
                    alert('ë…„ë„ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”. (150ì‚´ ì´ìƒì€ ê²€ìƒ‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤)');
                    birthdateInput.focus();
                    return;
                }

                // ì›” ìœ íš¨ì„± ê²€ì‚¬ (1-12ì›”)
                if (month < 1 || month > 12) {
                    alert('ì›”ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”. (1-12ì›”ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤)');
                    birthdateInput.focus();
                    return;
                }

                // ì¼ ìœ íš¨ì„± ê²€ì‚¬ (1-31ì¼)
                if (day < 1 || day > 31) {
                    alert('ì¼ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”. (1-31ì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤)');
                    birthdateInput.focus();
                    return;
                }

                // ì›”ë³„ ì¼ìˆ˜ ì²´í¬
                const daysInMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                if (day > daysInMonth[month - 1]) {
                    alert(`${month}ì›”ì€ ìµœëŒ€ ${daysInMonth[month - 1]}ì¼ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                    birthdateInput.focus();
                    return;
                }

                // hidden inputì— YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì €ì¥
                birthdateInput.name = '';  // ê¸°ì¡´ name ì œê±°
                const hiddenInput = document.getElementById('birthdate_hidden');
                hiddenInput.name = 'birthdate';  // hiddenì— name ë¶€ì—¬
                hiddenInput.value = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            }

            // í¼ì´ ì œì¶œë˜ì—ˆìŒì„ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            sessionStorage.setItem('fortuneFormSubmitted', 'true');

            // ë²„íŠ¼ ë¹„í™œì„±í™”
            submitBtn.disabled = true;
            submitBtn.textContent = 'ì¡°íšŒì¤‘...';

            // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
            loadingOverlay.classList.add('active');

            // í¼ ì œì¶œ
            quickFortuneForm.submit();
        });
    });
</script>
{% endblock %}
